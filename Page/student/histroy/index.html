<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中外历史事件对比时间轴</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        domestic: '#2563EB',
                        foreign: '#D97706',
                        unparsed: '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .timeline-line {
                @apply absolute left-1/2 transform -translate-x-1/2 h-full w-1 bg-gray-200 z-0;
            }
            .timeline-dot {
                @apply absolute left-1/2 transform -translate-x-1/2 w-4 h-4 rounded-full bg-primary z-10 border-4 border-white shadow-md transition-all duration-300;
            }
            .timeline-dot-unparsed {
                @apply bg-unparsed;
            }
            .event-card {
                @apply bg-white rounded-lg shadow-md p-4 transition-all duration-500 hover:shadow-xl transform hover:-translate-y-1;
            }
            .event-card-domestic {
                @apply border-l-4 border-domestic;
            }
            .event-card-foreign {
                @apply border-r-4 border-foreign;
            }
            .event-card-unparsed {
                @apply border-l-4 border-unparsed md:border-r-4;
            }
            .fade-in {
                animation: fadeIn 0.8s ease-out forwards;
            }
            .slide-in-left {
                animation: slideInLeft 0.6s ease-out forwards;
            }
            .slide-in-right {
                animation: slideInRight 0.6s ease-out forwards;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideInLeft {
                from { opacity: 0; transform: translateX(-30px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes slideInRight {
                from { opacity: 0; transform: translateX(30px); }
                to { opacity: 1; transform: translateX(0); }
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- 顶部导航 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300" id="main-header">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800">
                中外历史事件对比时间轴
            </h1>
            
            <!-- 筛选控制 -->
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <div class="flex items-center bg-gray-100 rounded-lg p-2">
                    <span class="px-3 py-1 text-gray-700">教育级别:</span>
                    <button id="btn-all" class="px-4 py-1 rounded-md bg-primary text-white transition-all">全部</button>
                    <button id="btn-junior" class="px-4 py-1 rounded-md hover:bg-gray-200 transition-all">初中</button>
                    <button id="btn-senior" class="px-4 py-1 rounded-md hover:bg-gray-200 transition-all">高中</button>
                </div>
                
                <div class="flex items-center flex-wrap justify-center gap-4">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-domestic mr-2"></span>
                        <span class="text-gray-700">国内事件</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-foreign mr-2"></span>
                        <span class="text-gray-700">国外事件</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-unparsed mr-2"></span>
                        <span class="text-gray-700">未解析时间</span>
                    </div>
                </div>
            </div>

            <!-- 状态信息 -->
            <div class="text-center mt-3 text-sm">
                <span id="status-info" class="text-gray-600">
                    加载中... <i class="fa fa-circle-o-notch fa-spin"></i>
                </span>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto px-4 py-8">
        <div class="relative">
            <!-- 中央时间轴 -->
            <div class="timeline-line"></div>
            
            <!-- 事件容器 -->
            <div id="events-container" class="space-y-16">
                <!-- 加载状态 -->
                <div id="loading" class="flex flex-col justify-center items-center py-20">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
                    <p class="text-gray-600">正在加载历史事件数据...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- 回到顶部按钮 -->
    <button id="back-to-top" class="fixed bottom-6 right-6 bg-primary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/50">
        <i class="fa fa-arrow-up"></i>
    </button>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>历史事件对比时间轴 &copy; 2023</p>
            <p class="text-gray-400 text-sm mt-2">数据来源: history.json</p>
        </div>
    </footer>

    <script>
        // 全局变量
        let allEvents = [];
        let parsedEvents = [];
        let unparsedEvents = [];
        let currentFilter = 'all';

        // 初始化函数
        async function init() {
            try {
                // 从JSON文件加载数据
                const response = await fetch('history.json');
                if (!response.ok) throw new Error(`HTTP错误: ${response.status}`);
                
                const data = await response.json();
                allEvents = data.timeline || [];
                
                // 分离解析成功和失败的事件
                separateParsedEvents(allEvents);
                
                // 更新状态信息
                updateStatusInfo();
                
                // 渲染所有事件
                renderAllEvents();
                
                // 绑定事件监听
                bindEvents();
                
            } catch (error) {
                console.error('加载错误:', error);
                document.getElementById('status-info').innerHTML = `
                    <span class="text-red-500">数据加载失败 <i class="fa fa-exclamation-circle"></i> 请检查history.json文件</span>
                `;
                document.getElementById('loading').innerHTML = `
                    <div class="text-center text-red-500">
                        <i class="fa fa-exclamation-triangle text-3xl mb-2"></i>
                        <p>无法加载历史数据</p>
                        <p class="text-sm mt-1">错误: ${error.message}</p>
                    </div>
                `;
            }
        }

        // 分离解析成功和失败的事件
        function separateParsedEvents(events) {
            parsedEvents = [];
            unparsedEvents = [];
            
            events.forEach(event => {
                // 尝试解析时间
                const timeValue = parseTime(event.time);
                // 如果解析结果是Infinity，则视为解析失败
                if (timeValue === Infinity) {
                    unparsedEvents.push(event);
                } else {
                    // 为解析成功的事件添加时间值，便于排序
                    parsedEvents.push({...event, timeValue});
                }
            });
            
            // 对解析成功的事件排序
            parsedEvents.sort((a, b) => a.timeValue - b.timeValue);
        }

        // 更新状态信息
        function updateStatusInfo() {
            const total = allEvents.length;
            const parsed = parsedEvents.length;
            const unparsed = unparsedEvents.length;
            const junior = allEvents.filter(e => e.education_level === '初中').length;
            const senior = allEvents.filter(e => e.education_level === '高中').length;
            
            document.getElementById('status-info').innerHTML = `
                共 <span class="font-semibold">${total}</span> 个事件 
                (解析: <span class="font-semibold">${parsed}</span>, 
                未解析: <span class="font-semibold text-unparsed">${unparsed}</span>,
                初中: <span class="font-semibold">${junior}</span>,
                高中: <span class="font-semibold">${senior}</span>)
            `;
        }

        // 渲染所有事件（先渲染解析成功的，最后渲染未解析的）
        function renderAllEvents() {
            const container = document.getElementById('events-container');
            container.innerHTML = '';
            
            // 先渲染解析成功的事件
            const filteredParsed = filterEvents(parsedEvents);
            filteredParsed.forEach((event, index) => {
                renderEvent(event, index, false);
            });
            
            // 最后渲染未解析的事件
            const filteredUnparsed = filterEvents(unparsedEvents);
            filteredUnparsed.forEach((event, index) => {
                renderEvent(event, index + filteredParsed.length, true);
            });
            
            // 如果没有事件
            if (filteredParsed.length === 0 && filteredUnparsed.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-20 text-gray-500">
                        <i class="fa fa-folder-open-o text-5xl mb-4"></i>
                        <p>没有找到符合条件的事件</p>
                    </div>
                `;
            }
        }

        // 根据筛选条件过滤事件
        function filterEvents(events) {
            if (currentFilter === 'all') return events;
            return events.filter(event => event.education_level === currentFilter);
        }

        // 渲染单个事件
        function renderEvent(event, index, isUnparsed) {
            const container = document.getElementById('events-container');
            
            // 创建事件项
            const eventItem = document.createElement('div');
            eventItem.className = 'relative flex flex-col md:flex-row items-center z-10 opacity-0';
            // 延迟动画，创造瀑布流效果
            setTimeout(() => {
                eventItem.classList.add('fade-in');
            }, index * 100);
            
            // 时间点
            const timeDot = document.createElement('div');
            timeDot.className = `timeline-dot ${isUnparsed ? 'timeline-dot-unparsed' : ''}`;
            
            // 时间标签（完整显示原始时间文本）
            const timeLabel = document.createElement('div');
            timeLabel.className = `absolute left-1/2 transform -translate-x-1/2 -top-6 px-3 py-1 rounded-full whitespace-nowrap text-sm
                ${isUnparsed ? 'bg-unparsed text-white' : 'bg-primary text-white'}`;
            timeLabel.textContent = event.time;
            // 未解析时间添加标记
            if (isUnparsed) {
                timeLabel.innerHTML += ' <i class="fa fa-question-circle" title="时间格式无法解析"></i>';
            }
            
            // 事件卡片
            const isDomestic = !isUnparsed && (event.region === '国内' || !event.region);
            const card = document.createElement('div');
            card.className = `
                md:w-5/12 event-card 
                ${isUnparsed ? 'event-card-unparsed md:ml-[50%] md:transform md:-translate-x-1/2' : 
                  isDomestic ? 'event-card-domestic md:mr-auto md:pr-8 md:text-right slide-in-right' : 
                  'event-card-foreign md:ml-auto md:pl-8 slide-in-left'}
            `;
            
            // 卡片内容
            card.innerHTML = `
                <div class="flex ${isDomestic || isUnparsed ? 'md:justify-end' : 'justify-start'} items-center mb-2">
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${event.education_level === '初中' ? 'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800'}">
                        ${event.education_level}
                    </span>
                    ${isUnparsed ? '<span class="ml-2 text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-full">时间未解析</span>' : ''}
                </div>
                <h3 class="text-lg font-bold mb-1 ${isUnparsed ? 'text-unparsed' : isDomestic ? 'text-domestic' : 'text-foreign'}">${event.event}</h3>
                <p class="text-gray-700 text-sm mb-2">${event.significance}</p>
                ${event.additional_info ? `<p class="text-gray-500 text-xs italic">${event.additional_info}</p>` : ''}
            `;
            
            // 组装元素
            eventItem.append(timeLabel, timeDot, card);
            container.appendChild(eventItem);
        }

        // 增强版时间解析函数
        function parseTime(timeStr) {
            // 处理"约X万年前"
            const yearAgoMatch = timeStr.match(/约?(\d+)万年前/);
            if (yearAgoMatch) {
                return -parseInt(yearAgoMatch[1]) * 10000;
            }
            
            // 处理"约公元前X年"和"公元前X年"
            const bcMatch = timeStr.match(/约?公元前(\d+)/);
            if (bcMatch) {
                return -parseInt(bcMatch[1]);
            }
            
            // 处理"公元前X年-X年"（取起始年）
            const bcRangeMatch = timeStr.match(/公元前(\d+)-/);
            if (bcRangeMatch) {
                return -parseInt(bcRangeMatch[1]);
            }
            
            // 处理"公元X年"
            const adMatch = timeStr.match(/公元(\d+)/);
            if (adMatch) {
                return parseInt(adMatch[1]);
            }
            
            // 处理"X世纪X年代"
            const centuryMatch = timeStr.match(/(\d+)世纪(\d+)年代/);
            if (centuryMatch) {
                return (parseInt(centuryMatch[1]) - 1) * 100 + parseInt(centuryMatch[2]);
            }
            
            // 处理"X年-X年"（取起始年）
            const rangeMatch = timeStr.match(/^(\d+)-/);
            if (rangeMatch) {
                return parseInt(rangeMatch[1]);
            }
            
            // 处理普通年份
            const yearMatch = timeStr.match(/(\d{4})/);
            if (yearMatch) {
                return parseInt(yearMatch[1]);
            }
            
            // 无法解析的时间返回Infinity，会被放到最后
            return Infinity;
        }

        // 绑定事件
        function bindEvents() {
            // 筛选按钮
            document.getElementById('btn-all').addEventListener('click', () => {
                setFilter('all');
            });
            document.getElementById('btn-junior').addEventListener('click', () => {
                setFilter('初中');
            });
            document.getElementById('btn-senior').addEventListener('click', () => {
                setFilter('高中');
            });
            
            // 回到顶部按钮
            const backToTop = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => {
                // 滚动超过500px显示回到顶部按钮
                if (window.scrollY > 500) {
                    backToTop.classList.remove('opacity-0', 'invisible');
                    backToTop.classList.add('opacity-100', 'visible');
                } else {
                    backToTop.classList.add('opacity-0', 'invisible');
                    backToTop.classList.remove('opacity-100', 'visible');
                }
                
                // 导航栏滚动效果
                const header = document.getElementById('main-header');
                if (window.scrollY > 100) {
                    header.classList.add('py-3', 'shadow-lg');
                    header.classList.remove('py-6', 'shadow-md');
                } else {
                    header.classList.add('py-6', 'shadow-md');
                    header.classList.remove('py-3', 'shadow-lg');
                }
            });
            
            backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // 添加滚动动画效果 - 当元素进入视口时显示动画
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('opacity-100');
                        entry.target.classList.remove('opacity-0');
                    }
                });
            }, { threshold: 0.1 });

            // 观察所有事件项
            document.querySelectorAll('.event-card').forEach(card => {
                observer.observe(card);
            });
        }

        // 设置筛选条件
        function setFilter(filter) {
            currentFilter = filter;
            
            // 更新按钮样式
            ['btn-all', 'btn-junior', 'btn-senior'].forEach(id => {
                const btn = document.getElementById(id);
                btn.classList.toggle('bg-primary', id === `btn-${filter === 'all' ? 'all' : filter === '初中' ? 'junior' : 'senior'}`);
                btn.classList.toggle('text-white', id === `btn-${filter === 'all' ? 'all' : filter === '初中' ? 'junior' : 'senior'}`);
                btn.classList.toggle('hover:bg-gray-200', !(id === `btn-${filter === 'all' ? 'all' : filter === '初中' ? 'junior' : 'senior'}`));
            });
            
            // 重新渲染所有事件
            renderAllEvents();
            
            // 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

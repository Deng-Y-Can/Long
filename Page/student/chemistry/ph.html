<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©è´¨pHå€¼æ•°æ®åº“</title>
    <!-- ä½¿ç”¨å¤šä¸ªCDNæºæé«˜å¯ç”¨æ€§ï¼Œå¢åŠ å¤‡ç”¨é“¾æ¥ -->
    <!-- Font Awesome - ä¸»CDN + å¤‡ç”¨CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
          onerror="this.onerror=null;this.href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css';">
    <!-- Chart.js - ä¸»CDN + å¤‡ç”¨CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"
            onerror="this.onerror=null;this.src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.8/chart.umd.min.js';"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        acid: '#e53e3e',      // é…¸æ€§ç‰©è´¨é¢œè‰² - çº¢è‰²ç³»
                        neutral: '#ecc94b',   // ä¸­æ€§ç‰©è´¨é¢œè‰² - é»„è‰²ç³»
                        base: '#3182ce',      // ç¢±æ€§ç‰©è´¨é¢œè‰² - è“è‰²ç³»
                        primary: '#4a5568',   // ä¸»è¦æ–‡æœ¬é¢œè‰²
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .pH-gradient {
                background: linear-gradient(90deg, #e53e3e 0%, #ecc94b 50%, #3182ce 100%);
            }

            .card-hover {
                transition: all 0.3s ease;
            }

                .card-hover:hover {
                    transform: translateY(-5px);
                }

            .btn-active {
                transform: scale(1.03);
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            }
        }
    </style>

    <!-- åŸºç¡€æ ·å¼ä¿éšœ -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.5;
            color: #1f2937;
            background-color: #f9fafb;
        }

        .container {
            width: 100%;
            margin-right: auto;
            margin-left: auto;
            padding-right: 1rem;
            padding-left: 1rem;
        }

        @media (min-width: 640px) {
            .container {
                max-width: 640px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
            }
        }

        @media (min-width: 1280px) {
            .container {
                max-width: 1280px;
            }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .spinner {
            border: 3px solid rgba(75, 85, 99, 0.1);
            border-radius: 50%;
            border-top-color: #4a5568;
            animation: spin 1s ease-in-out infinite;
            width: 2rem;
            height: 2rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .fa:before {
            content: attr(data-icon);
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="sticky top-0 z-50 bg-white shadow-md transition-all duration-300">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fa fa-flask text-3xl text-primary mr-3" data-icon="âš—ï¸"></i>
                <h1 class="text-2xl font-bold">ç‰©è´¨pHå€¼æ•°æ®åº“</h1>
            </div>

            <div class="flex flex-wrap gap-2 justify-center">
                <button id="btn-all" class="px-4 py-2 bg-primary text-white rounded-full hover:bg-opacity-90 transition-all flex items-center btn btn-active">
                    <i class="fa fa-th-large mr-2" data-icon="â˜°"></i>å…¨éƒ¨ç‰©è´¨
                </button>
                <button id="btn-acid" class="px-4 py-2 bg-acid text-white rounded-full hover:bg-opacity-90 transition-all flex items-center btn">
                    <i class="fa fa-lemon-o mr-2" data-icon="ğŸ‹"></i>é…¸æ€§ç‰©è´¨
                </button>
                <button id="btn-neutral" class="px-4 py-2 bg-neutral text-white rounded-full hover:bg-opacity-90 transition-all flex items-center btn">
                    <i class="fa fa-balance-scale mr-2" data-icon="âš–ï¸"></i>ä¸­æ€§ç‰©è´¨
                </button>
                <button id="btn-base" class="px-4 py-2 bg-base text-white rounded-full hover:bg-opacity-90 transition-all flex items-center btn">
                    <i class="fa fa-tint mr-2" data-icon="ğŸ’§"></i>ç¢±æ€§ç‰©è´¨
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8">
        <!-- ä»‹ç»å’Œæœç´¢åŒº -->
        <section class="mb-10">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6 card">
                <h2 class="text-xl font-semibold mb-3">å…³äºpHå€¼</h2>
                <p class="text-gray-600 mb-4">pHå€¼æ˜¯è¡¡é‡ç‰©è´¨é…¸ç¢±åº¦çš„æŒ‡æ ‡ï¼ŒèŒƒå›´ä»0åˆ°14ã€‚pHå€¼å°äº7çš„ç‰©è´¨ä¸ºé…¸æ€§ï¼Œç­‰äº7ä¸ºä¸­æ€§ï¼Œå¤§äº7ä¸ºç¢±æ€§ã€‚æœ¬æ•°æ®åº“æ”¶é›†äº†å¤šç§å¸¸è§ç‰©è´¨çš„pHå€¼ä¿¡æ¯ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£å„ç±»ç‰©è´¨çš„é…¸ç¢±ç‰¹æ€§ã€‚</p>

                <!-- pHå€¼èŒƒå›´æŒ‡ç¤ºå™¨ -->
                <div class="mt-6 mb-4">
                    <div class="flex justify-between text-sm mb-1">
                        <span>å¼ºé…¸æ€§</span>
                        <span>ä¸­æ€§</span>
                        <span>å¼ºç¢±æ€§</span>
                    </div>
                    <div class="pH-gradient h-4 rounded-full relative">
                        <div class="absolute top-0 left-0 w-full h-1 bg-black bg-opacity-10"></div>
                        <div class="absolute top-0 left-[0%] w-1 h-4 bg-black"></div>
                        <div class="absolute top-0 left-[50%] w-1 h-4 bg-black"></div>
                        <div class="absolute top-0 left-[100%] w-1 h-4 bg-black -ml-0.5"></div>
                        <div class="absolute -bottom-6 left-[0%] text-xs">0</div>
                        <div class="absolute -bottom-6 left-[50%] text-xs -ml-1.5">7</div>
                        <div class="absolute -bottom-6 left-[100%] text-xs -ml-1.5">14</div>
                    </div>
                </div>
            </div>

            <!-- æœç´¢å’Œç­›é€‰ -->
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <div class="relative flex-grow">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" data-icon="ğŸ”"></i>
                    <input type="text" id="search-input" placeholder="æœç´¢ç‰©è´¨åç§°..."
                           class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                </div>

                <div class="flex gap-4">
                    <select id="category-filter" class="px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                        <option value="all">æ‰€æœ‰ç±»åˆ«</option>
                        <!-- ç±»åˆ«å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                    </select>

                    <select id="strength-filter" class="px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                        <option value="all">æ‰€æœ‰å¼ºåº¦</option>
                        <option value="weak">å¼±</option>
                        <option value="strong">å¼º</option>
                        <option value="neutral">ä¸­æ€§</option>
                    </select>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-acid bg-opacity-10 rounded-xl p-6 border-l-4 border-acid card">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-lemon-o mr-2" data-icon="ğŸ‹"></i>é…¸æ€§ç‰©è´¨
                    </h3>
                    <p class="text-3xl font-bold" id="acid-count">0</p>
                    <p class="text-gray-600 text-sm mt-2">pHå€¼å°äº7çš„ç‰©è´¨</p>
                </div>

                <div class="bg-neutral bg-opacity-10 rounded-xl p-6 border-l-4 border-neutral card">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-balance-scale mr-2" data-icon="âš–ï¸"></i>ä¸­æ€§ç‰©è´¨
                    </h3>
                    <p class="text-3xl font-bold" id="neutral-count">0</p>
                    <p class="text-gray-600 text-sm mt-2">pHå€¼ç­‰äº7çš„ç‰©è´¨</p>
                </div>

                <div class="bg-base bg-opacity-10 rounded-xl p-6 border-l-4 border-base card">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-tint mr-2" data-icon="ğŸ’§"></i>ç¢±æ€§ç‰©è´¨
                    </h3>
                    <p class="text-3xl font-bold" id="base-count">0</p>
                    <p class="text-gray-600 text-sm mt-2">pHå€¼å¤§äº7çš„ç‰©è´¨</p>
                </div>
            </div>

            <!-- å›¾è¡¨å±•ç¤º -->
            <div id="chart-container" class="bg-white rounded-xl shadow-lg p-6 mb-8 card">
                <h3 class="text-lg font-semibold mb-4">ç‰©è´¨ç±»åˆ«åˆ†å¸ƒ</h3>
                <div class="h-64 flex items-center justify-center">
                    <div id="chart-loading" class="flex flex-col items-center">
                        <div class="spinner mb-3"></div>
                        <p class="text-gray-500">åŠ è½½å›¾è¡¨ä¸­...</p>
                    </div>
                    <canvas id="category-chart" class="hidden w-full h-full"></canvas>
                    <div id="chart-fallback" class="hidden text-center p-6">
                        <i class="fa fa-bar-chart text-5xl text-gray-300 mb-4" data-icon="ğŸ“Š"></i>
                        <h4 class="text-lg font-medium mb-2">å›¾è¡¨åŠ è½½å¤±è´¥</h4>
                        <p class="text-gray-500">æ— æ³•åŠ è½½å›¾è¡¨ç»„ä»¶ï¼Œæ‚¨ä»å¯ä»¥æŸ¥çœ‹ç‰©è´¨åˆ—è¡¨å’Œè¯¦ç»†ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç‰©è´¨åˆ—è¡¨ -->
        <section>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">ç‰©è´¨åˆ—è¡¨</h2>
                <div class="text-gray-500 flex items-center">
                    <span id="total-showing">0</span>
                    <span class="mx-1">/</span>
                    <span id="total-items">0</span>
                    <span class="ml-1">ç§ç‰©è´¨</span>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loading" class="flex justify-center items-center py-16">
                <div class="spinner"></div>
                <p class="ml-3 text-gray-500">åŠ è½½ç‰©è´¨æ•°æ®ä¸­...</p>
            </div>

            <!-- é”™è¯¯çŠ¶æ€ -->
            <div id="error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative" role="alert">
                <strong class="font-bold">åŠ è½½å¤±è´¥!</strong>
                <span class="block sm:inline mt-2">
                    æ— æ³•åŠ è½½pHå€¼æ•°æ®ï¼Œå¯èƒ½çš„è§£å†³æ–¹æ³•ï¼š<br>
                    1. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>
                    2. åˆ·æ–°é¡µé¢é‡è¯•<br>
                    3. ç¡®ä¿JSONæ•°æ®æ–‡ä»¶è·¯å¾„æ­£ç¡®
                </span>
                <button id="retry-btn" class="mt-3 bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200 transition-colors">
                    é‡è¯•åŠ è½½
                </button>
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div id="empty" class="hidden flex flex-col items-center justify-center py-16 text-center">
                <i class="fa fa-search text-5xl text-gray-300 mb-4" data-icon="ğŸ”"></i>
                <h3 class="text-xl font-semibold mb-2">æœªæ‰¾åˆ°åŒ¹é…çš„ç‰©è´¨</h3>
                <p class="text-gray-500">å°è¯•ä½¿ç”¨ä¸åŒçš„æœç´¢æ¡ä»¶æˆ–æµè§ˆå…¨éƒ¨ç‰©è´¨</p>
                <button id="reset-filter" class="mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-all btn">
                    é‡ç½®ç­›é€‰æ¡ä»¶
                </button>
            </div>

            <!-- ç‰©è´¨å¡ç‰‡å®¹å™¨ -->
            <div id="substances-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- ç‰©è´¨å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- åˆ†é¡µæ§ä»¶ -->
            <div id="pagination" class="mt-10 flex justify-center items-center">
                <button id="prev-page" class="px-4 py-2 mx-1 rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed btn">
                    <i class="fa fa-chevron-left" data-icon="â†"></i>
                </button>
                <span id="page-info" class="mx-4">ç¬¬ 1 é¡µ / å…± 0 é¡µ</span>
                <button id="next-page" class="px-4 py-2 mx-1 rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed btn">
                    <i class="fa fa-chevron-right" data-icon="â†’"></i>
                </button>
            </div>
        </section>
    </main>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 id="modal-title" class="text-2xl font-bold"></h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times text-xl" data-icon="âœ•"></i>
                    </button>
                </div>
            </div>

            <div class="p-6">
                <div class="flex items-center mb-6">
                    <div id="modal-ph-indicator" class="w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl mr-4"></div>
                    <div>
                        <p class="text-gray-500">pHå€¼</p>
                        <p id="modal-ph-value" class="text-3xl font-bold"></p>
                        <p id="modal-type-strength" class="text-gray-600"></p>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2" data-icon="â„¹ï¸"></i>ç‰©è´¨ç‰¹æ€§
                    </h4>
                    <p id="modal-properties" class="text-gray-600"></p>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-briefcase text-primary mr-2" data-icon="ğŸ’¼"></i>ç”¨é€”
                    </h4>
                    <ul id="modal-uses" class="list-disc pl-5 text-gray-600 space-y-1"></ul>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-exclamation-triangle text-amber-500 mr-2" data-icon="âš ï¸"></i>æ½œåœ¨å±å®³
                    </h4>
                    <ul id="modal-hazards" class="list-disc pl-5 text-gray-600 space-y-1"></ul>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-shield text-primary mr-2" data-icon="ğŸ›¡ï¸"></i>å®‰å…¨æç¤º
                    </h4>
                    <p id="modal-safety" class="text-gray-600"></p>
                </div>
            </div>

            <div class="p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl">
                <button id="close-modal-btn" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-all btn">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-10 mt-16">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center">
                        <i class="fa fa-flask text-2xl mr-2" data-icon="âš—ï¸"></i>
                        <h2 class="text-xl font-bold">ç‰©è´¨pHå€¼æ•°æ®åº“</h2>
                    </div>
                    <p class="text-gray-400 mt-2">å…¨é¢çš„ç‰©è´¨é…¸ç¢±åº¦å‚è€ƒèµ„æº</p>
                </div>

                <div class="flex flex-wrap justify-center gap-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-question-circle mr-1" data-icon="?"></i>å…³äº
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-file-text-o mr-1" data-icon="ğŸ“„"></i>ä½¿ç”¨è¯´æ˜
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-envelope-o mr-1" data-icon="âœ‰ï¸"></i>è”ç³»æˆ‘ä»¬
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-github mr-1" data-icon="ğŸ™"></i>æºç 
                    </a>
                </div>
            </div>

            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400 text-sm">
                <p>Â© 2023 ç‰©è´¨pHå€¼æ•°æ®åº“ - ä»…ä¾›å‚è€ƒå­¦ä¹ ä½¿ç”¨</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // å…¨å±€å˜é‡ - æ–°å¢å½“å‰ç­›é€‰ç±»å‹å˜é‡
        let substances = [];
        let filteredSubstances = [];
        let currentPage = 1;
        const itemsPerPage = 12;
        let categoryChart = null;
        let currentFilterType = 'all'; // è·Ÿè¸ªå½“å‰ç­›é€‰ç±»å‹ï¼šall, acid, neutral, base

        // DOM å…ƒç´ 
        const substancesContainer = document.getElementById('substances-container');
        const loadingIndicator = document.getElementById('loading');
        const errorIndicator = document.getElementById('error');
        const emptyIndicator = document.getElementById('empty');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const strengthFilter = document.getElementById('strength-filter');
        const totalShowingElement = document.getElementById('total-showing');
        const totalItemsElement = document.getElementById('total-items');
        const acidCountElement = document.getElementById('acid-count');
        const neutralCountElement = document.getElementById('neutral-count');
        const baseCountElement = document.getElementById('base-count');
        const pageInfoElement = document.getElementById('page-info');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        const detailModal = document.getElementById('detail-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalPhValue = document.getElementById('modal-ph-value');
        const modalTypeStrength = document.getElementById('modal-type-strength');
        const modalProperties = document.getElementById('modal-properties');
        const modalUses = document.getElementById('modal-uses');
        const modalHazards = document.getElementById('modal-hazards');
        const modalSafety = document.getElementById('modal-safety');
        const modalPhIndicator = document.getElementById('modal-ph-indicator');
        const closeModalButton = document.getElementById('close-modal');
        const closeModalBtnElement = document.getElementById('close-modal-btn');
        const retryButton = document.getElementById('retry-btn');
        const resetFilterButton = document.getElementById('reset-filter');
        const chartLoading = document.getElementById('chart-loading');
        const categoryChartElement = document.getElementById('category-chart');
        const chartFallback = document.getElementById('chart-fallback');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½æ•°æ®
            loadData();

            // äº‹ä»¶ç›‘å¬
            setupEventListeners();
        });

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                loadingIndicator.classList.remove('hidden');
                errorIndicator.classList.add('hidden');
                emptyIndicator.classList.add('hidden');

                // è¯·å°†æ­¤å¤„æ›¿æ¢ä¸ºæ‚¨çš„ph_substances.jsonæ–‡ä»¶å®é™…è·¯å¾„
                const response = await fetch('ph.json');

                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }

                substances = await response.json();
                filteredSubstances = [...substances];

                // å¤„ç†æ•°æ®
                processData();

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                loadingIndicator.classList.add('hidden');
                errorIndicator.classList.remove('hidden');
            }
        }

        // å¤„ç†æ•°æ®
        function processData() {
            // å¡«å……ç±»åˆ«è¿‡æ»¤å™¨
            populateCategoryFilter();

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStatistics();

            // åˆ›å»ºç±»åˆ«åˆ†å¸ƒå›¾è¡¨ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
            createCategoryChart().catch(err => {
                console.error('åˆ›å»ºå›¾è¡¨å¤±è´¥:', err);
                showChartFallback();
            });

            // æ˜¾ç¤ºç‰©è´¨åˆ—è¡¨
            renderSubstances();

            // éšè—åŠ è½½æŒ‡ç¤ºå™¨
            loadingIndicator.classList.add('hidden');
        }

        // å¡«å……ç±»åˆ«è¿‡æ»¤å™¨
        function populateCategoryFilter() {
            const categories = new Set();
            substances.forEach(substance => {
                categories.add(substance.category);
            });

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = formatCategoryName(category);
                categoryFilter.appendChild(option);
            });
        }

        // æ ¼å¼åŒ–ç±»åˆ«åç§°
        function formatCategoryName(category) {
            const categoryMap = {
                'food': 'é£Ÿå“',
                'personal care': 'ä¸ªäººæŠ¤ç†',
                'household': 'å®¶ç”¨äº§å“',
                'industrial': 'å·¥ä¸šåŒ–å­¦å“',
                'biological': 'ç”Ÿç‰©ä½“æ¶²'
            };
            return categoryMap[category] || category.charAt(0).toUpperCase() + category.slice(1);
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            const acidCount = substances.filter(s => s.type === 'acid').length;
            const neutralCount = substances.filter(s => s.type === 'neutral').length;
            const baseCount = substances.filter(s => s.type === 'base').length;

            acidCountElement.textContent = acidCount;
            neutralCountElement.textContent = neutralCount;
            baseCountElement.textContent = baseCount;
            totalItemsElement.textContent = substances.length;
        }

        // åˆ›å»ºç±»åˆ«åˆ†å¸ƒå›¾è¡¨
        async function createCategoryChart() {
            // æ£€æŸ¥Chartæ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof Chart === 'undefined') {
                // ç­‰å¾…ä¸€å°æ®µæ—¶é—´å†æ£€æŸ¥ï¼Œç»™å¤‡ç”¨CDNåŠ è½½æ—¶é—´
                await new Promise(resolve => setTimeout(resolve, 1000));

                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.jsæœªåŠ è½½æˆåŠŸ');
                }
            }

            // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºå›¾è¡¨
            chartLoading.classList.add('hidden');
            categoryChartElement.classList.remove('hidden');

            const ctx = categoryChartElement.getContext('2d');

            // ç»Ÿè®¡æ¯ä¸ªç±»åˆ«çš„ç‰©è´¨æ•°é‡
            const categoryCounts = {};
            substances.forEach(substance => {
                if (!categoryCounts[substance.category]) {
                    categoryCounts[substance.category] = 0;
                }
                categoryCounts[substance.category]++;
            });

            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = Object.keys(categoryCounts).map(formatCategoryName);
            const data = Object.values(categoryCounts);
            const backgroundColors = [
                'rgba(229, 62, 62, 0.7)',   // é…¸æ€§è‰²
                'rgba(236, 206, 75, 0.7)',  // ä¸­æ€§è‰²
                'rgba(49, 130, 206, 0.7)',  // ç¢±æ€§è‰²
                'rgba(66, 153, 225, 0.7)',
                'rgba(72, 187, 120, 0.7)',
                'rgba(160, 99, 245, 0.7)'
            ];

            // åˆ›å»ºå›¾è¡¨
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors.slice(0, labels.length),
                        borderColor: backgroundColors.slice(0, labels.length).map(color =>
                            color.replace('0.7', '1')
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ˜¾ç¤ºå›¾è¡¨åŠ è½½å¤±è´¥çš„å¤‡ç”¨å†…å®¹
        function showChartFallback() {
            chartLoading.classList.add('hidden');
            chartFallback.classList.remove('hidden');
        }

        // æ¸²æŸ“ç‰©è´¨åˆ—è¡¨
        function renderSubstances() {
            // æ¸…ç©ºå®¹å™¨
            substancesContainer.innerHTML = '';

            // è®¡ç®—åˆ†é¡µ
            const totalPages = Math.ceil(filteredSubstances.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentItems = filteredSubstances.slice(startIndex, endIndex);

            // æ›´æ–°æ˜¾ç¤ºè®¡æ•°
            totalShowingElement.textContent = filteredSubstances.length;

            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            pageInfoElement.textContent = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ`;
            prevPageButton.disabled = currentPage === 1;
            nextPageButton.disabled = currentPage === totalPages || totalPages === 0;

            // æ˜¾ç¤ºç©ºçŠ¶æ€
            if (filteredSubstances.length === 0) {
                emptyIndicator.classList.remove('hidden');
                return;
            } else {
                emptyIndicator.classList.add('hidden');
            }

            // åˆ›å»ºç‰©è´¨å¡ç‰‡
            currentItems.forEach(substance => {
                const card = createSubstanceCard(substance);
                substancesContainer.appendChild(card);
            });
        }

        // åˆ›å»ºç‰©è´¨å¡ç‰‡
        function createSubstanceCard(substance) {
            const card = document.createElement('div');
            card.className = `bg-white rounded-xl shadow-md overflow-hidden card-hover cursor-pointer card`;

            // ç¡®å®šå¡ç‰‡é¢œè‰²
            let bgColor, textColor;
            if (substance.type === 'acid') {
                bgColor = 'bg-acid';
                textColor = 'text-white';
            } else if (substance.type === 'neutral') {
                bgColor = 'bg-neutral';
                textColor = 'text-gray-800';
            } else { // base
                bgColor = 'bg-base';
                textColor = 'text-white';
            }

            // è®¾ç½®å¡ç‰‡å†…å®¹
            card.innerHTML = `
                    <div class="${bgColor} ${textColor} p-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium uppercase tracking-wide">${formatCategoryName(substance.category)}</span>
                            <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm font-bold">pH ${substance.pH}</span>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">${substance.name}</h3>
                        <p class="text-gray-600 text-sm line-clamp-2 mb-3">${substance.properties.substring(0, 80)}${substance.properties.length > 80 ? '...' : ''}</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500">${substance.strength}${substance.type !== 'neutral' ? substance.type === 'acid' ? 'é…¸æ€§' : 'ç¢±æ€§' : ''}</span>
                            <button class="text-primary hover:text-primary-dark transition-colors">
                                æŸ¥çœ‹è¯¦æƒ… <i class="fa fa-arrow-right ml-1" data-icon="â†’"></i>
                            </button>
                        </div>
                    </div>
                `;

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            card.addEventListener('click', () => {
                openDetailModal(substance);
            });

            return card;
        }

        // æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
        function openDetailModal(substance) {
            // è®¾ç½®æ¨¡æ€æ¡†å†…å®¹
            modalTitle.textContent = substance.name;
            modalPhValue.textContent = substance.pH;

            // è®¾ç½®pHæŒ‡ç¤ºå™¨æ ·å¼
            let indicatorColor;
            if (substance.type === 'acid') {
                indicatorColor = 'bg-acid';
                modalTypeStrength.textContent = `å¼ºé…¸æ€§ç‰©è´¨ (pH < 7)`;
            } else if (substance.type === 'neutral') {
                indicatorColor = 'bg-neutral';
                modalTypeStrength.textContent = `ä¸­æ€§ç‰©è´¨ (pH = 7)`;
            } else { // base
                indicatorColor = 'bg-base';
                modalTypeStrength.textContent = `å¼ºç¢±æ€§ç‰©è´¨ (pH > 7)`;
            }

            modalPhIndicator.className = `${indicatorColor} w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl mr-4`;
            modalPhIndicator.textContent = substance.pH;

            modalProperties.textContent = substance.properties;

            // å¡«å……ç”¨é€”åˆ—è¡¨
            modalUses.innerHTML = '';
            substance.uses.forEach(use => {
                const li = document.createElement('li');
                li.textContent = use;
                modalUses.appendChild(li);
            });

            // å¡«å……å±å®³åˆ—è¡¨
            modalHazards.innerHTML = '';
            substance.hazards.forEach(hazard => {
                const li = document.createElement('li');
                li.textContent = hazard;
                modalHazards.appendChild(li);
            });

            modalSafety.textContent = substance.safety;

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            detailModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        }

        // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
        function closeDetailModal() {
            detailModal.classList.add('hidden');
            document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        }

        // è¿‡æ»¤ç‰©è´¨ - æ ¸å¿ƒç­›é€‰é€»è¾‘ä¼˜åŒ–
        function filterSubstances() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const category = categoryFilter.value;
            const strength = strengthFilter.value;

            // ä½¿ç”¨å…¨å±€å˜é‡currentFilterTypeç¡®ä¿ç­›é€‰ç±»å‹æ­£ç¡®
            filteredSubstances = substances.filter(substance => {
                // æœç´¢è¯è¿‡æ»¤
                const matchesSearch = substance.name.toLowerCase().includes(searchTerm) ||
                    substance.properties.toLowerCase().includes(searchTerm);

                // ç±»åˆ«è¿‡æ»¤
                const matchesCategory = category === 'all' || substance.category === category;

                // å¼ºåº¦è¿‡æ»¤
                const matchesStrength = strength === 'all' || substance.strength === strength;

                // ç±»å‹è¿‡æ»¤ - ä½¿ç”¨å…¨å±€å˜é‡ç¡®ä¿å‡†ç¡®æ€§
                const matchesType = currentFilterType === 'all' || substance.type === currentFilterType;

                return matchesSearch && matchesCategory && matchesStrength && matchesType;
            });

            // é‡ç½®å½“å‰é¡µç 
            currentPage = 1;

            // é‡æ–°æ¸²æŸ“
            renderSubstances();
        }

        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilters() {
            searchInput.value = '';
            categoryFilter.value = 'all';
            strengthFilter.value = 'all';
            // é‡ç½®ç­›é€‰ç±»å‹å¹¶æ›´æ–°æŒ‰é’®çŠ¶æ€
            currentFilterType = 'all';
            setActiveButton('btn-all');
            filterSubstances();
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ - å¢å¼ºæŒ‰é’®ç‚¹å‡»å¤„ç†
        function setupEventListeners() {
            // æœç´¢å’Œç­›é€‰äº‹ä»¶
            searchInput.addEventListener('input', filterSubstances);
            categoryFilter.addEventListener('change', filterSubstances);
            strengthFilter.addEventListener('change', filterSubstances);

            // ç±»å‹ç­›é€‰æŒ‰é’® - æ˜ç¡®æ›´æ–°currentFilterType
            document.getElementById('btn-all').addEventListener('click', () => {
                currentFilterType = 'all';
                setActiveButton('btn-all');
                filterSubstances();
            });

            document.getElementById('btn-acid').addEventListener('click', () => {
                currentFilterType = 'acid';
                setActiveButton('btn-acid');
                filterSubstances();
            });

            document.getElementById('btn-neutral').addEventListener('click', () => {
                currentFilterType = 'neutral';
                setActiveButton('btn-neutral');
                filterSubstances();
            });

            document.getElementById('btn-base').addEventListener('click', () => {
                currentFilterType = 'base';
                setActiveButton('btn-base');
                filterSubstances();
            });

            // åˆ†é¡µæŒ‰é’®
            prevPageButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderSubstances();
                }
            });

            nextPageButton.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredSubstances.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderSubstances();
                }
            });

            // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
            closeModalButton.addEventListener('click', closeDetailModal);
            closeModalBtnElement.addEventListener('click', closeDetailModal);

            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            detailModal.addEventListener('click', (e) => {
                if (e.target === detailModal) {
                    closeDetailModal();
                }
            });

            // é‡è¯•åŠ è½½æŒ‰é’®
            retryButton.addEventListener('click', loadData);

            // é‡ç½®ç­›é€‰æŒ‰é’®
            resetFilterButton.addEventListener('click', resetFilters);

            // æ»šåŠ¨æ—¶æ”¹å˜å¯¼èˆªæ æ ·å¼
            window.addEventListener('scroll', () => {
                const header = document.querySelector('header');
                if (window.scrollY > 10) {
                    header.classList.add('py-2');
                    header.classList.remove('py-4');
                } else {
                    header.classList.add('py-4');
                    header.classList.remove('py-2');
                }
            });
        }

        // è®¾ç½®æ´»è·ƒæŒ‰é’®æ ·å¼ - å¢å¼ºè§†è§‰åé¦ˆ
        function setActiveButton(buttonId) {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('#btn-all, #btn-acid, #btn-neutral, #btn-base').forEach(btn => {
                btn.classList.remove('btn-active', 'ring-2', 'ring-offset-2');
            });

            // è®¾ç½®å½“å‰æŒ‰é’®ä¸ºæ´»è·ƒçŠ¶æ€
            const activeButton = document.getElementById(buttonId);
            activeButton.classList.add('btn-active', 'ring-2', 'ring-offset-2');

            // æ ¹æ®æŒ‰é’®ç±»å‹è®¾ç½®ä¸åŒçš„è¾¹æ¡†é¢œè‰²
            if (buttonId === 'btn-acid') {
                activeButton.classList.add('ring-acid');
            } else if (buttonId === 'btn-neutral') {
                activeButton.classList.add('ring-neutral');
            } else if (buttonId === 'btn-base') {
                activeButton.classList.add('ring-base');
            } else {
                activeButton.classList.add('ring-primary');
            }
        }
    </script>
</body>
</html>
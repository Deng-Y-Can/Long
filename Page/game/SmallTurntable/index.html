<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candyå°è½¬ç›˜</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- é…ç½® Tailwind è‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ - ç²¾è‡´æµ…æš–è‰²æ–¹æ¡ˆ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#E87722',    // ä¸»è‰²è°ƒï¼šæ¸©æš–æ©™è‰²
                        secondary: '#F5A623',  // è¾…åŠ©è‰²ï¼šæ˜äº®æš–é»„
                        accent: '#D05A00',     // å¼ºè°ƒè‰²ï¼šæ·±æ©™è‰²
                        neutral: '#FFF8F0',    // ä¸­æ€§è‰²ï¼šç±³ç™½è‰²
                        divider: '#C8A27A',    // åˆ†éš”çº¿é¢œè‰²ï¼šæš–æ£•è‰²
                        panel: '#FFFFFF80',    // é¢æ¿èƒŒæ™¯ï¼šåŠé€æ˜ç™½è‰²
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        display: ['Poppins', 'sans-serif']
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(232, 119, 34, 0.08)',
                        'warm': '0 6px 25px rgba(245, 166, 35, 0.12)',
                        'glow': '0 0 15px rgba(245, 166, 35, 0.3)',
                    }
                },
            }
        }
    </script>

    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .perspective-1000 {
                perspective: 1000px;
            }

            .preserve-3d {
                transform-style: preserve-3d;
            }

            .backface-hidden {
                backface-visibility: hidden;
            }

            .rotate-y-180 {
                transform: rotateY(180deg);
            }

            .wheel-gradient {
                background: conic-gradient( var(--color-0) var(--angle-0), var(--color-1) var(--angle-0) var(--angle-1), var(--color-2) var(--angle-1) var(--angle-2), var(--color-3) var(--angle-2) var(--angle-3), var(--color-4) var(--angle-3) var(--angle-4), var(--color-5) var(--angle-4) var(--angle-5), var(--color-6) var(--angle-5) var(--angle-6), var(--color-7) var(--angle-6) 360deg );
            }

            .pointer-bounce {
                animation: pointerBounce 2s infinite ease-in-out;
            }

            @keyframes pointerBounce {
                0%, 100% {
                    transform: translateY(0);
                }

                50% {
                    transform: translateY(-5px);
                }
            }

            .shine-effect {
                position: relative;
                overflow: hidden;
            }

                .shine-effect::after {
                    content: '';
                    position: absolute;
                    top: -50%;
                    left: -50%;
                    width: 200%;
                    height: 200%;
                    background: linear-gradient( to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0) 100% );
                    transform: rotate(30deg);
                    animation: shine 7s infinite;
                }

            @keyframes shine {
                0% {
                    transform: translateX(-100%) rotate(30deg);
                }

                100% {
                    transform: translateX(100%) rotate(30deg);
                }
            }

            .text-shadow {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }

            .wheel-divider {
                position: absolute;
                top: 0;
                left: 50%;
                width: 2px;
                height: 50%;
                transform-origin: bottom center;
                background-color: theme('colors.divider');
                z-index: 5;
            }

                .wheel-divider::after {
                    content: '';
                    position: absolute;
                    top: -4px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    background-color: theme('colors.divider');
                }

            .pulse-effect {
                animation: pulse 3s infinite;
            }

            @keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.02);
                }
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-neutral via-amber-50 to-neutral min-h-screen font-sans text-gray-800">
    <!-- é¡µé¢å®¹å™¨ -->
    <div class="container mx-auto px-4 py-6 md:py-10 max-w-7xl">
        <!-- æ ‡é¢˜éƒ¨åˆ† -->
        <header class="text-center mb-6 md:mb-10">
            <div class="inline-flex items-center gap-2 bg-white/90 backdrop-blur-sm rounded-full px-6 py-2.5 shadow-warm mb-4 pulse-effect">
                <i class="fa fa-refresh text-accent text-2xl"></i>
                <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-display font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">
                    ç²¾è‡´æ¯”ä¾‹è½¬ç›˜
                </h1>
            </div>
            <p class="text-gray-600 text-base md:text-lg max-w-2xl mx-auto">
                æ¸…æ™°åˆ†éš”æ¯ä¸ªé€‰é¡¹ï¼ŒæŒ‰æ¯”ä¾‹éšæœºé€‰æ‹©ï¼Œä¼˜é›…è§†è§‰ä½“éªŒ
            </p>
        </header>

        <!-- ä¸»è¦å†…å®¹åŒº -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8 items-start">
            <!-- å·¦ä¾§ï¼šè½¬ç›˜è®¾ç½®é¢æ¿ -->
            <section class="lg:col-span-1 bg-panel backdrop-blur-sm rounded-2xl shadow-soft p-5 md:p-6 transition-all duration-300 hover:shadow-warm border border-amber-100/80">
                <h2 class="text-xl font-bold mb-5 flex items-center font-display text-gray-800">
                    <i class="fa fa-sliders mr-2 text-accent"></i> é€‰é¡¹è®¾ç½®
                </h2>

                <!-- æ–¹æ¡ˆä¿å­˜å’ŒåŠ è½½åŒºåŸŸ -->
                <div class="mb-6 p-4 bg-amber-50/80 rounded-xl border border-amber-100/90">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                        <i class="fa fa-save text-primary mr-2"></i> æ–¹æ¡ˆç®¡ç†
                    </h3>

                    <div class="flex gap-2 mb-3">
                        <input type="text" id="schemeName" placeholder="æ–¹æ¡ˆåç§°" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                        <button id="saveScheme" type="button" class="bg-primary hover:bg-primary/90 text-white px-3 py-2 rounded-md transition-all transform hover:scale-105">
                            <i class="fa fa-floppy-o"></i>
                        </button>
                    </div>

                    <div class="relative">
                        <select id="loadScheme" class="w-full px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 appearance-none text-gray-800 transition-all">
                            <option value="">-- é€‰æ‹©ä¿å­˜çš„æ–¹æ¡ˆ --</option>
                            <!-- ä¿å­˜çš„æ–¹æ¡ˆå°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                            <i class="fa fa-chevron-down text-gray-500 text-xs"></i>
                        </div>
                    </div>

                    <div class="flex gap-2 mt-3">
                        <button id="deleteScheme" type="button" class="flex-1 bg-red-100 hover:bg-red-200 text-red-700 px-3 py-2 rounded-md transition-colors transform hover:scale-105">
                            <i class="fa fa-trash-o mr-1"></i> åˆ é™¤æ–¹æ¡ˆ
                        </button>
                        <button id="clearAllSchemes" type="button" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md transition-colors transform hover:scale-105">
                            <i class="fa fa-trash mr-1"></i> æ¸…ç©ºæ‰€æœ‰
                        </button>
                    </div>
                </div>

                <!-- é€‰é¡¹è®¾ç½®åŒºåŸŸ -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                        <i class="fa fa-list-ul text-secondary mr-2"></i> å†…å®¹åˆ—è¡¨
                        <span class="ml-2 text-sm font-normal text-gray-600">(æ¯”ä¾‹å†³å®šæ¦‚ç‡)</span>
                    </h3>

                    <!-- é€‰é¡¹åˆ—è¡¨ -->
                    <div id="optionList" class="space-y-3 mb-4 max-h-64 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-primary/30">
                        <!-- åˆå§‹é€‰é¡¹é¡¹ -->
                        <div class="option-item flex items-center gap-3 p-3 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md">
                            <input type="text" placeholder="é€‰é¡¹å†…å®¹" value="ç”µå½±" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <input type="number" placeholder="æ¦‚ç‡" value="1" min="1" max="10" class="w-16 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <button type="button" class="delete-option text-red-500 hover:text-red-600 transition-colors p-1 transform hover:scale-110">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                        <div class="option-item flex items-center gap-3 p-3 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md">
                            <input type="text" placeholder="é€‰é¡¹å†…å®¹" value="æ¸¸æˆ" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <input type="number" placeholder="æ¦‚ç‡" value="2" min="1" max="10" class="w-16 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <button type="button" class="delete-option text-red-500 hover:text-red-600 transition-colors p-1 transform hover:scale-110">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                        <div class="option-item flex items-center gap-3 p-3 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md">
                            <input type="text" placeholder="é€‰é¡¹å†…å®¹" value="çœ‹ä¹¦" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <input type="number" placeholder="æ¦‚ç‡" value="1" min="1" max="10" class="w-16 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <button type="button" class="delete-option text-red-500 hover:text-red-600 transition-colors p-1 transform hover:scale-110">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                        <div class="option-item flex items-center gap-3 p-3 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md">
                            <input type="text" placeholder="é€‰é¡¹å†…å®¹" value="è¿åŠ¨" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <input type="number" placeholder="æ¦‚ç‡" value="3" min="1" max="10" class="w-16 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
                            <button type="button" class="delete-option text-red-500 hover:text-red-600 transition-colors p-1 transform hover:scale-110">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- æ·»åŠ é€‰é¡¹æŒ‰é’® -->
                    <button id="addOption" type="button" class="w-full py-2.5 px-4 bg-gradient-to-r from-primary to-secondary hover:opacity-95 text-white rounded-lg transition-all flex items-center justify-center gap-2 shadow-md hover:shadow-warm transform hover:scale-[1.02]">
                        <i class="fa fa-plus-circle"></i> æ·»åŠ é€‰é¡¹
                    </button>
                </div>

                <!-- åŠŸèƒ½è®¾ç½® -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                        <i class="fa fa-cog text-secondary mr-2"></i> æ—‹è½¬è®¾ç½®
                    </h3>

                    <!-- é˜²é‡å¤æŠ½å–é€‰é¡¹ -->
                    <div class="flex items-center gap-2 p-3 bg-amber-50/80 rounded-lg border border-amber-100/90 transition-all hover:shadow-md">
                        <input type="checkbox" id="preventDuplicates" class="w-5 h-5 text-primary rounded focus:ring-primary/50">
                        <label for="preventDuplicates" class="cursor-pointer text-gray-700">ä¸é‡å¤é€‰æ‹©å·²æŠ½é€‰é¡¹</label>
                    </div>

                    <!-- æ—‹è½¬å¼ºåº¦è®¾ç½® -->
                    <div class="p-3 bg-amber-50/80 rounded-lg border border-amber-100/90 transition-all hover:shadow-md">
                        <label for="spinIntensity" class="block text-sm font-medium text-gray-700 mb-1">æ—‹è½¬å¼ºåº¦</label>
                        <input type="range" id="spinIntensity" min="3" max="10" value="7" class="w-full h-2 bg-amber-100 rounded-lg appearance-none cursor-pointer accent-primary">
                        <div class="flex justify-between text-xs text-gray-600 mt-1">
                            <span>è½»æŸ”</span>
                            <span id="intensityValue">ä¸­ç­‰</span>
                            <span>å¼ºåŠ²</span>
                        </div>
                    </div>

                    <!-- åº”ç”¨è®¾ç½®æŒ‰é’® -->
                    <button id="applySettings" type="button" class="w-full py-3 bg-gradient-to-r from-primary to-accent text-white rounded-xl transition-all duration-300 transform hover:scale-[1.02] font-medium shadow-warm hover:shadow-glow font-display text-lg">
                        åº”ç”¨è®¾ç½®
                    </button>
                </div>
            </section>

            <!-- ä¸­é—´ï¼šè½¬ç›˜åŒºåŸŸ - å®Œå–„åˆ†éš”çº¿ -->
            <section class="lg:col-span-1 flex flex-col items-center">
                <!-- ç«‹ä½“è½¬ç›˜å®¹å™¨ -->
                <div class="relative w-full max-w-md aspect-square mx-auto perspective-1000">
                    <!-- è½¬ç›˜åº•åº§é˜´å½± -->
                    <div class="absolute inset-[10%] rounded-full bg-gradient-to-br from-amber-300/30 to-transparent blur-xl transform rotate-3 scale-105 -z-10"></div>

                    <!-- è½¬ç›˜å®¹å™¨ - 3Dæ•ˆæœ -->
                    <div class="absolute inset-0 flex items-center justify-center preserve-3d">
                        <!-- è½¬ç›˜èƒŒé¢ï¼ˆä»…è§†è§‰æ•ˆæœï¼‰ -->
                        <div class="absolute w-[85%] h-[85%] rounded-full bg-amber-100 shadow-inner backface-hidden rotate-y-180"></div>

                        <!-- è½¬ç›˜æ­£é¢ - å¸¦å®Œå–„çš„åˆ†éš”çº¿ -->
                        <div id="wheel" class="absolute w-[85%] h-[85%] rounded-full shadow-warm backface-hidden shine-effect overflow-hidden cursor-pointer transition-all hover:shadow-glow">
                            <!-- åˆ†éš”çº¿å®¹å™¨ -->
                            <div id="wheelDividers" class="absolute inset-0 rounded-full"></div>

                            <!-- è½¬ç›˜ä¸­å¿ƒè£…é¥° -->
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-16 h-16 rounded-full bg-white border-4 border-amber-200 shadow-lg flex items-center justify-center z-10">
                                    <div class="w-12 h-12 rounded-full bg-gradient-to-r from-primary to-accent flex items-center justify-center text-white font-bold transform transition-transform hover:scale-110">
                                        <i class="fa fa-play"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- è½¬ç›˜ä¸Šçš„æ–‡æœ¬æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div id="wheelLabels" class="absolute inset-0 rounded-full"></div>
                        </div>
                    </div>

                    <!-- å›ºå®šæŒ‡é’ˆ - ç²¾è‡´è®¾è®¡ -->
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/4 z-20 pointer-bounce">
                        <div class="relative">
                            <!-- æŒ‡é’ˆé˜´å½± -->
                            <div class="absolute -inset-1 bg-gradient-to-r from-primary to-accent rounded-full blur-md opacity-70"></div>
                            <!-- æŒ‡é’ˆä¸»ä½“ -->
                            <div class="relative w-8 h-16 bg-gradient-to-b from-primary to-accent rounded-t-full flex items-start justify-center p-1 shadow-warm">
                                <div class="w-3 h-3 bg-white rounded-full z-10"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—‹è½¬æŒ‰é’® -->
                <button id="spinButton" class="mt-10 py-3 px-8 bg-gradient-to-r from-primary to-accent text-white rounded-full shadow-warm hover:shadow-glow transition-all duration-300 transform hover:scale-105 font-bold text-lg font-display">
                    <i class="fa fa-refresh mr-2"></i> å¼€å§‹æ—‹è½¬
                </button>

                <!-- ç»“æœæ˜¾ç¤º - å¸¦æœ‰å¼¹å‡ºåŠ¨ç”» -->
                <div id="resultDisplay" class="mt-6 text-center opacity-0 scale-90 transition-all duration-500">
                    <div class="p-4 bg-white/90 backdrop-blur-sm rounded-xl shadow-warm border border-amber-100 inline-block transform transition-all hover:scale-105">
                        <h3 class="text-xl font-bold text-accent mb-1 font-display">é€‰ä¸­ç»“æœ</h3>
                        <p id="resultText" class="text-lg font-medium text-gray-800">æ¨èæ´»åŠ¨ï¼šç”µå½±</p>
                    </div>
                </div>
            </section>

            <!-- å³ä¾§ï¼šé€‰æ‹©è®°å½•å’Œæ¦‚ç‡è¯´æ˜ -->
            <section class="lg:col-span-1 bg-panel backdrop-blur-sm rounded-2xl shadow-soft p-5 md:p-6 transition-all duration-300 hover:shadow-warm border border-amber-100/80">
                <h2 class="text-xl font-bold mb-5 flex items-center font-display text-gray-800">
                    <i class="fa fa-history mr-2 text-accent"></i> é€‰æ‹©è®°å½•
                </h2>

                <!-- æ¸…ç©ºè®°å½•æŒ‰é’® -->
                <button id="clearHistory" type="button" class="text-sm text-gray-600 hover:text-red-600 transition-colors mb-4 flex items-center transform hover:scale-105">
                    <i class="fa fa-trash-o mr-1"></i> æ¸…ç©ºè®°å½•
                </button>

                <!-- è®°å½•åˆ—è¡¨ -->
                <div id="historyList" class="space-y-3 max-h-[300px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-primary/30">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fa fa-clipboard-list text-4xl mb-2 text-amber-200"></i>
                        <p>æš‚æ— é€‰æ‹©è®°å½•</p>
                    </div>
                </div>

                <!-- æ¦‚ç‡è¯´æ˜ -->
                <div class="mt-6 p-4 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                        <i class="fa fa-pie-chart text-secondary mr-2"></i> æ¦‚ç‡åˆ†å¸ƒ
                    </h3>
                    <div id="probabilityDistribution" class="space-y-2 text-sm">
                        <!-- æ¦‚ç‡åˆ†å¸ƒå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- å·²é€‰é€‰é¡¹ -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-3 text-gray-800 flex items-center">
                        <i class="fa fa-check-square-o text-secondary mr-2"></i> å·²é€‰é€‰é¡¹
                    </h3>
                    <div id="selectedOptions" class="flex flex-wrap gap-2">
                        <!-- å·²é€‰é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </section>
        </main>

        <!-- é¡µè„š -->
        <footer class="mt-10 text-center text-gray-600 text-sm py-4">
            <p>ğŸ¡ ç²¾è‡´åˆ†éš”çº¿è®¾è®¡ Â· æŒ‰æ¯”ä¾‹éšæœºé€‰æ‹© ğŸ¡</p>
        </footer>
    </div>

    <!-- æç¤ºæ¡† -->
    <div id="toast" class="fixed top-4 right-4 bg-white/95 backdrop-blur-sm text-gray-800 px-4 py-2.5 rounded-lg shadow-warm transform translate-x-full transition-transform duration-300 flex items-center gap-2 z-50 border-l-4 border-primary">
        <i class="fa fa-info-circle text-primary"></i>
        <span id="toastMessage">æç¤ºä¿¡æ¯</span>
    </div>

    <script>
        // ç”Ÿæˆç²¾è‡´æµ…æš–è‰²æ–¹æ¡ˆ
        function generateWarmColors(count) {
            const warmColors = [
                '#FFE0B2', // æµ…æ©™è‰²
                '#FFCC80', // æš–æ©™è‰²
                '#FFEFD5', // æµ…ç±³è‰²
                '#FFF3E0', // ææµ…æ©™è‰²
                '#FFD54F', // é‡‘é»„è‰²
                '#FFCCBC', // æµ…çº¢æ£•è‰²
                '#FFE0B2', // æµ…æ©™é»„è‰²
                '#FFB74D'  // ä¸­æ©™è‰²
            ];

            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(warmColors[i % warmColors.length]);
            }
            return colors;
        }

        // ç”Ÿæˆé«˜äº®é¢œè‰²
        function getHighlightColor(color) {
            const highlightMap = {
                '#FFE0B2': '#FFCC80',
                '#FFCC80': '#FFB74D',
                '#FFEFD5': '#FFE0B2',
                '#FFF3E0': '#FFE0B2',
                '#FFD54F': '#FFC107',
                '#FFCCBC': '#FFB74D',
                '#FFB74D': '#FF9800'
            };

            return highlightMap[color] || color;
        }

        // å…¨å±€å˜é‡
        let options = [];          // é€‰é¡¹åˆ—è¡¨
        let selectedOptions = [];  // å·²é€‰æ‹©çš„é€‰é¡¹
        let isSpinning = false;    // è½¬ç›˜æ˜¯å¦æ­£åœ¨æ—‹è½¬
        let spinIntensity = 7;     // æ—‹è½¬å¼ºåº¦
        let currentRotation = 0;   // å½“å‰æ—‹è½¬è§’åº¦
        let colors = [];           // é¢œè‰²æ–¹æ¡ˆ
        const SCHEME_STORAGE_KEY = 'finalSpinningWheelSchemes'; // å­˜å‚¨æ–¹æ¡ˆçš„localStorageé”®å

        // DOMå…ƒç´ 
        const wheel = document.getElementById('wheel');
        const wheelLabels = document.getElementById('wheelLabels');
        const wheelDividers = document.getElementById('wheelDividers');
        const spinButton = document.getElementById('spinButton');
        const resultDisplay = document.getElementById('resultDisplay');
        const resultText = document.getElementById('resultText');
        const optionList = document.getElementById('optionList');
        const addOptionButton = document.getElementById('addOption');
        const applySettingsButton = document.getElementById('applySettings');
        const preventDuplicatesCheckbox = document.getElementById('preventDuplicates');
        const spinIntensitySlider = document.getElementById('spinIntensity');
        const intensityValueDisplay = document.getElementById('intensityValue');
        const historyList = document.getElementById('historyList');
        const selectedOptionsContainer = document.getElementById('selectedOptions');
        const clearHistoryButton = document.getElementById('clearHistory');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const probabilityDistribution = document.getElementById('probabilityDistribution');
        // æ–¹æ¡ˆç®¡ç†å…ƒç´ 
        const schemeNameInput = document.getElementById('schemeName');
        const saveSchemeButton = document.getElementById('saveScheme');
        const loadSchemeSelect = document.getElementById('loadScheme');
        const deleteSchemeButton = document.getElementById('deleteScheme');
        const clearAllSchemesButton = document.getElementById('clearAllSchemes');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½åˆå§‹é€‰é¡¹
            loadInitialOptions();
            // åº”ç”¨è®¾ç½®ï¼ˆç¡®ä¿åˆ†éš”çº¿æ­£ç¡®æ˜¾ç¤ºï¼‰
            applySettings();
            // åŠ è½½ä¿å­˜çš„æ–¹æ¡ˆ
            loadSavedSchemes();

            // äº‹ä»¶ç›‘å¬
            spinButton.addEventListener('click', spinWheel);
            wheel.addEventListener('click', spinWheel); // ç‚¹å‡»è½¬ç›˜ä¹Ÿå¯ä»¥æ—‹è½¬
            addOptionButton.addEventListener('click', addOptionField);
            applySettingsButton.addEventListener('click', applySettings);
            spinIntensitySlider.addEventListener('input', updateIntensityDisplay);
            clearHistoryButton.addEventListener('click', clearHistory);

            // æ–¹æ¡ˆç®¡ç†äº‹ä»¶
            saveSchemeButton.addEventListener('click', saveCurrentScheme);
            loadSchemeSelect.addEventListener('change', loadSelectedScheme);
            deleteSchemeButton.addEventListener('click', deleteSelectedScheme);
            clearAllSchemesButton.addEventListener('click', clearAllSchemes);

            // ä¸ºåˆå§‹é€‰é¡¹é¡¹æ·»åŠ åˆ é™¤äº‹ä»¶
            document.querySelectorAll('.delete-option').forEach(button => {
                button.addEventListener('click', function () {
                    if (document.querySelectorAll('.option-item').length > 2) {
                        this.closest('.option-item').remove();
                    } else {
                        showToast('è‡³å°‘ä¿ç•™2ä¸ªé€‰é¡¹');
                    }
                });
            });
        });

        // åŠ è½½åˆå§‹é€‰é¡¹
        function loadInitialOptions() {
            const optionItems = document.querySelectorAll('.option-item');
            options = Array.from(optionItems).map((item, index) => {
                const nameInput = item.querySelector('input[type="text"]');
                const ratioInput = item.querySelector('input[type="number"]');
                return {
                    name: nameInput.value,
                    ratio: parseInt(ratioInput.value)
                };
            });
        }

        // æ·»åŠ é€‰é¡¹è¾“å…¥æ¡†
        function addOptionField() {
            const newOptionItem = document.createElement('div');
            newOptionItem.className = 'option-item flex items-center gap-3 p-3 bg-amber-50/80 rounded-xl border border-amber-100/90 transition-all hover:shadow-md';
            newOptionItem.innerHTML = `
            <input type="text" placeholder="é€‰é¡¹å†…å®¹" class="flex-1 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
            <input type="number" placeholder="æ¦‚ç‡" value="1" min="1" max="10" class="w-16 px-3 py-2 bg-white border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-gray-800 transition-all">
            <button type="button" class="delete-option text-red-500 hover:text-red-600 transition-colors p-1 transform hover:scale-110">
              <i class="fa fa-trash"></i>
            </button>
          `;

            // æ·»åŠ åˆ é™¤äº‹ä»¶
            newOptionItem.querySelector('.delete-option').addEventListener('click', function () {
                if (document.querySelectorAll('.option-item').length > 2) {
                    newOptionItem.remove();
                } else {
                    showToast('è‡³å°‘ä¿ç•™2ä¸ªé€‰é¡¹');
                }
            });

            optionList.appendChild(newOptionItem);
        }

        // æ›´æ–°æ—‹è½¬å¼ºåº¦æ˜¾ç¤º
        function updateIntensityDisplay() {
            spinIntensity = parseInt(spinIntensitySlider.value);

            // æ˜¾ç¤ºå¯¹åº”çš„å¼ºåº¦æ–‡æœ¬
            let intensityText = 'è½»æŸ”';
            if (spinIntensity > 3 && spinIntensity < 7) intensityText = 'é€‚ä¸­';
            if (spinIntensity >= 7 && spinIntensity < 9) intensityText = 'ä¸­ç­‰';
            if (spinIntensity >= 9) intensityText = 'å¼ºåŠ²';

            intensityValueDisplay.textContent = intensityText;
        }

        // åº”ç”¨è®¾ç½® - ä¿®å¤åˆ†éš”çº¿é—®é¢˜
        function applySettings() {
            // æ”¶é›†é€‰é¡¹æ•°æ®
            const optionItems = document.querySelectorAll('.option-item');

            if (optionItems.length < 2) {
                showToast('è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹');
                return;
            }

            // ç”Ÿæˆæ–°çš„æµ…æš–è‰²æ–¹æ¡ˆ
            colors = generateWarmColors(optionItems.length);

            // æ›´æ–°é€‰é¡¹åˆ—è¡¨
            options = Array.from(optionItems).map((item, index) => {
                const nameInput = item.querySelector('input[type="text"]');
                const ratioInput = item.querySelector('input[type="number"]');

                // éªŒè¯è¾“å…¥
                if (!nameInput.value.trim()) {
                    nameInput.value = `é€‰é¡¹${index + 1}`;
                }

                if (!ratioInput.value || ratioInput.value < 1) {
                    ratioInput.value = 1;
                }

                return {
                    name: nameInput.value.trim(),
                    ratio: parseInt(ratioInput.value),
                    color: colors[index],
                    highlightColor: getHighlightColor(colors[index])
                };
            });

            // é‡æ–°ç»˜åˆ¶è½¬ç›˜å’Œåˆ†éš”çº¿ï¼ˆç¡®ä¿æ‰€æœ‰åˆ†éš”çº¿éƒ½æ˜¾ç¤ºï¼‰
            renderWheel();
            // æ›´æ–°æ¦‚ç‡åˆ†å¸ƒæ˜¾ç¤º
            updateProbabilityDistribution();

            showToast('è®¾ç½®å·²åº”ç”¨');
        }

        // æ¸²æŸ“è½¬ç›˜ - ç¡®ä¿æ‰€æœ‰é€‰é¡¹é—´éƒ½æœ‰åˆ†éš”çº¿
        function renderWheel() {
            // æ¸…ç©ºç°æœ‰æ ‡ç­¾å’Œåˆ†éš”çº¿
            wheelLabels.innerHTML = '';
            wheelDividers.innerHTML = '';

            // è®¡ç®—æ€»æ¯”ä¾‹
            const totalRatio = options.reduce((sum, option) => sum + option.ratio, 0);

            // è®¡ç®—æ¯ä¸ªé€‰é¡¹çš„è§’åº¦å’Œæ¸å˜å˜é‡
            let cumulativeAngle = 0;
            options.forEach((option, index) => {
                const sliceAngle = (option.ratio / totalRatio) * 360;
                const endAngle = cumulativeAngle + sliceAngle;

                // è®¾ç½®CSSå˜é‡ç”¨äºé”¥å½¢æ¸å˜
                wheel.style.setProperty(`--color-${index}`, option.color);
                wheel.style.setProperty(`--angle-${index}`, `${cumulativeAngle}deg`);

                // åˆ›å»ºæ–‡æœ¬æ ‡ç­¾
                createWheelLabel(option, cumulativeAngle + sliceAngle / 2, sliceAngle);

                // ä¸ºæ¯ä¸ªé€‰é¡¹æ·»åŠ åˆ†éš”çº¿ï¼ˆåŒ…æ‹¬æœ€åä¸€ä¸ªé€‰é¡¹ï¼Œç¡®ä¿é—­åˆï¼‰
                createWheelDivider(endAngle);

                cumulativeAngle = endAngle;
            });

            // è®¾ç½®æœ€åä¸€ä¸ªè§’åº¦ä¸º360åº¦
            wheel.style.setProperty(`--angle-${options.length - 1}`, '360deg');

            // åº”ç”¨é”¥å½¢æ¸å˜
            wheel.className = `absolute w-[85%] h-[85%] rounded-full shadow-warm backface-hidden shine-effect overflow-hidden cursor-pointer wheel-gradient transition-all hover:shadow-glow`;

            // åº”ç”¨å½“å‰æ—‹è½¬è§’åº¦
            wheel.style.transform = `rotate(${currentRotation}deg)`;
        }

        // åˆ›å»ºè½¬ç›˜æ‰‡åŒºé—´çš„åˆ†éš”çº¿ - ç¡®ä¿æ‰€æœ‰é€‰é¡¹é—´éƒ½æœ‰åˆ†éš”
        function createWheelDivider(angle) {
            // è½¬æ¢è§’åº¦ä¸º0-360åº¦èŒƒå›´
            const normalizedAngle = angle % 360;

            const divider = document.createElement('div');
            divider.className = 'wheel-divider';

            // è®¾ç½®åˆ†éš”çº¿æ—‹è½¬è§’åº¦
            divider.style.transform = `rotate(${normalizedAngle}deg)`;

            wheelDividers.appendChild(divider);
        }

        // åˆ›å»ºè½¬ç›˜ä¸Šçš„æ–‡æœ¬æ ‡ç­¾
        function createWheelLabel(option, angle, sliceAngle) {
            const label = document.createElement('div');

            // è®¡ç®—æ–‡æœ¬ä½ç½®å’Œæ—‹è½¬è§’åº¦
            const radians = angle * Math.PI / 180;
            const radius = 42; // è·ç¦»ä¸­å¿ƒçš„ç™¾åˆ†æ¯”
            const x = 50 + radius * Math.cos(radians);
            const y = 50 + radius * Math.sin(radians);

            // æ–‡æœ¬æ—‹è½¬è§’åº¦ï¼ˆç¡®ä¿æ–‡å­—å§‹ç»ˆæœä¸Šï¼‰
            let textRotation = angle;
            if (angle > 90 && angle < 270) {
                textRotation += 180; // ç¿»è½¬180åº¦
            }

            // åŸºç¡€æ ·å¼
            label.className = 'absolute whitespace-nowrap transform -translate-x-1/2 -translate-y-1/2 transition-all duration-300 font-bold text-shadow';
            label.style.left = `${x}%`;
            label.style.top = `${y}%`;
            label.style.transform = `translate(-50%, -50%) rotate(${textRotation}deg)`;
            label.style.fontSize = 'clamp(0.85rem, 2.8vw, 1.1rem)';
            label.style.color = '#5D4037'; // æ·±æ£•è‰²æ–‡å­—ï¼Œç¡®ä¿é«˜è¯†åˆ«åº¦
            label.style.width = `${Math.min(sliceAngle * 0.9, 100)}px`;
            label.style.textAlign = 'center';
            label.textContent = option.name;

            wheelLabels.appendChild(label);
        }

        // æ›´æ–°æ¦‚ç‡åˆ†å¸ƒæ˜¾ç¤º
        function updateProbabilityDistribution() {
            probabilityDistribution.innerHTML = '';

            const totalRatio = options.reduce((sum, option) => sum + option.ratio, 0);

            options.forEach(option => {
                const probability = Math.round((option.ratio / totalRatio) * 100);
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center p-2 hover:bg-amber-100/50 rounded transition-colors';
                item.innerHTML = `
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full" style="background-color: ${option.color}"></div>
                <span>${option.name}</span>
              </div>
              <span class="font-medium">${probability}%</span>
            `;
                probabilityDistribution.appendChild(item);
            });
        }

        // æ—‹è½¬è½¬ç›˜ - æŒ‰æ¯”ä¾‹è®¡ç®—æ¦‚ç‡ï¼Œå®Œå…¨éšæœº
        function spinWheel() {
            if (isSpinning) return;

            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å¯é€‰çš„é€‰é¡¹
            let availableOptions = [...options];

            if (preventDuplicatesCheckbox.checked && selectedOptions.length > 0) {
                availableOptions = options.filter(option =>
                    !selectedOptions.some(selected => selected.name === option.name)
                );

                if (availableOptions.length === 0) {
                    showToast('æ‰€æœ‰é€‰é¡¹å·²é€‰æ‹©å®Œæ¯•ï¼');
                    return;
                }
            }

            isSpinning = true;
            spinButton.disabled = true;
            spinButton.classList.add('opacity-70', 'cursor-not-allowed');
            resultDisplay.classList.remove('opacity-100');
            resultDisplay.classList.add('opacity-0', 'scale-90');

            // éšè—æ‰€æœ‰é«˜äº®
            wheel.style.filter = 'none';

            // è®¡ç®—æ€»æ¯”ä¾‹ï¼ˆåªè€ƒè™‘å¯ç”¨é€‰é¡¹ï¼‰
            const totalRatio = availableOptions.reduce((sum, option) => sum + option.ratio, 0);

            // éšæœºé€‰æ‹©ä¸€ä¸ªé€‰é¡¹ - æŒ‰æ¯”ä¾‹æ¦‚ç‡
            const random = Math.random() * totalRatio;
            let cumulativeRatio = 0;
            let selectedOption = null;

            for (const option of availableOptions) {
                cumulativeRatio += option.ratio;
                if (random < cumulativeRatio) {
                    selectedOption = option;
                    break;
                }
            }

            // è®¡ç®—é€‰ä¸­é€‰é¡¹çš„è§’åº¦ä½ç½®
            const allTotalRatio = options.reduce((sum, option) => sum + option.ratio, 0);
            let angleOffset = 0;
            let targetAngle = 0;

            options.forEach(option => {
                const sliceAngle = (option.ratio / allTotalRatio) * 360;

                if (option.name === selectedOption.name && targetAngle === 0) {
                    // ç›®æ ‡è§’åº¦æ˜¯é€‰ä¸­åŒºåŸŸçš„ä¸­é—´ä½ç½®
                    targetAngle = 360 - (angleOffset + sliceAngle / 2);
                }

                angleOffset += sliceAngle;
            });

            // ç”Ÿæˆéšæœºæ—‹è½¬è§’åº¦åç§»ï¼ˆÂ±15åº¦ï¼‰ï¼Œå¢åŠ éšæœºæ€§
            const randomOffset = (Math.random() - 0.5) * 30; // -15åˆ°15åº¦ä¹‹é—´çš„éšæœºå€¼
            targetAngle += randomOffset;

            // æ ¹æ®æ—‹è½¬å¼ºåº¦è®¡ç®—æ€»æ—‹è½¬è§’åº¦ï¼ˆè‡³å°‘5åœˆï¼‰
            const baseSpins = 5 + (spinIntensity - 3) * 0.5; // 5-8åœˆ
            const totalSpinAngle = baseSpins * 360 + targetAngle;
            const finalRotation = (currentRotation + totalSpinAngle) % 360;

            // æƒ¯æ€§æ—‹è½¬æ•ˆæœ - ä½¿ç”¨requestAnimationFrameå®ç°éçº¿æ€§å‡é€Ÿ
            const startTime = performance.now();
            const duration = 2000 + (spinIntensity * 200); // æ—‹è½¬æŒç»­æ—¶é—´åŸºäºå¼ºåº¦
            const startRotation = currentRotation;

            // åº”ç”¨ç‰©ç†å‡é€Ÿå‡½æ•° - æ¨¡æ‹Ÿæ‘©æ“¦åŠ›å¯¼è‡´çš„å‡é€Ÿ
            function animate(currentTime) {
                if (!isSpinning) return;

                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // ç¼“åŠ¨å‡½æ•° - å¼€å§‹å¿«ï¼Œé€æ¸å‡é€Ÿï¼ˆæ¨¡æ‹Ÿæƒ¯æ€§ï¼‰
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const rotation = startRotation + totalSpinAngle * easeProgress;

                // åº”ç”¨æ—‹è½¬
                wheel.style.transform = `rotate(${rotation}deg)`;

                // ç»§ç»­åŠ¨ç”»æˆ–ç»“æŸ
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // åŠ¨ç”»ç»“æŸ
                    currentRotation = finalRotation;
                    wheel.style.transform = `rotate(${currentRotation}deg)`;
                    finishSpin(selectedOption);
                }
            }

            // å¼€å§‹åŠ¨ç”»
            requestAnimationFrame(animate);
        }

        // å®Œæˆæ—‹è½¬ï¼Œå¤„ç†ç»“æœ
        function finishSpin(selectedOption) {
            isSpinning = false;
            spinButton.disabled = false;
            spinButton.classList.remove('opacity-70', 'cursor-not-allowed');

            // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„ç»“æœ
            wheel.style.filter = `drop-shadow(0 0 15px ${selectedOption.highlightColor}80)`;

            // æ˜¾ç¤ºç»“æœ
            resultText.textContent = `æ¨èæ´»åŠ¨ï¼š${selectedOption.name}`;
            setTimeout(() => {
                resultDisplay.classList.remove('opacity-0', 'scale-90');
                resultDisplay.classList.add('opacity-100', 'scale-100');
            }, 300);

            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(selectedOption);

            // å¦‚æœå¼€å¯é˜²é‡å¤ï¼Œæ·»åŠ åˆ°å·²é€‰åˆ—è¡¨
            if (preventDuplicatesCheckbox.checked) {
                selectedOptions.push(selectedOption);
                updateSelectedOptions();
            }
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(option) {
            // å¦‚æœæ˜¯åˆå§‹çŠ¶æ€ï¼Œæ¸…ç©º"æš‚æ— è®°å½•"æç¤º
            if (historyList.querySelector('.text-center')) {
                historyList.innerHTML = '';
            }

            const historyItem = document.createElement('div');
            historyItem.className = 'p-3 rounded-lg border flex justify-between items-center transform transition-all duration-300 hover:shadow-md hover:shadow-primary/10 bg-amber-50/50';
            historyItem.style.borderColor = option.color;

            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

            historyItem.innerHTML = `
            <div class="flex items-center gap-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${option.color}"></div>
              <span class="font-medium text-gray-800">${option.name}</span>
            </div>
            <span class="text-xs text-gray-600">${timeString}</span>
          `;

            // æ·»åŠ åˆ°åˆ—è¡¨å¼€å¤´
            historyList.insertBefore(historyItem, historyList.firstChild);

            // æ·»åŠ è¿›å…¥åŠ¨ç”»
            historyItem.style.transform = 'translateX(-10px)';
            historyItem.style.opacity = '0';
            setTimeout(() => {
                historyItem.style.transform = 'translateX(0)';
                historyItem.style.opacity = '1';
            }, 50);
        }

        // æ›´æ–°å·²é€‰é€‰é¡¹æ˜¾ç¤º
        function updateSelectedOptions() {
            selectedOptionsContainer.innerHTML = '';

            // å»é‡æ˜¾ç¤º
            const uniqueSelectedOptions = [...new Map(selectedOptions.map(option => [option.name, option])).values()];

            uniqueSelectedOptions.forEach(option => {
                const badge = document.createElement('span');
                badge.className = 'px-2 py-1 rounded-full text-xs flex items-center gap-1 font-medium text-gray-800 transition-all hover:scale-110';
                badge.style.backgroundColor = option.color;
                badge.innerHTML = `
              ${option.name}
              <i class="fa fa-check"></i>
            `;
                selectedOptionsContainer.appendChild(badge);
            });
        }

        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
            const items = historyList.querySelectorAll('div:not(.text-center)');
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.style.transform = 'translateX(10px)';
                    item.style.opacity = '0';
                    setTimeout(() => item.remove(), 300);
                }, index * 50);
            });

            // å»¶è¿Ÿæ˜¾ç¤ºç©ºçŠ¶æ€
            setTimeout(() => {
                if (historyList.children.length === 0 ||
                    (historyList.children.length === items.length &&
                        !historyList.querySelector('.text-center'))) {
                    historyList.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                  <i class="fa fa-clipboard-list text-4xl mb-2 text-amber-200"></i>
                  <p>æš‚æ— é€‰æ‹©è®°å½•</p>
                </div>
              `;
                }
            }, items.length * 50 + 300);

            // é‡ç½®å·²é€‰é€‰é¡¹
            selectedOptions = [];
            selectedOptionsContainer.innerHTML = '';

            showToast('è®°å½•å·²æ¸…ç©º');
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.remove('translate-x-full');

            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // æ–¹æ¡ˆç®¡ç†åŠŸèƒ½
        function getSavedSchemes() {
            const schemesJson = localStorage.getItem(SCHEME_STORAGE_KEY);
            return schemesJson ? JSON.parse(schemesJson) : {};
        }

        function saveSchemes(schemes) {
            localStorage.setItem(SCHEME_STORAGE_KEY, JSON.stringify(schemes));
        }

        function loadSavedSchemes() {
            const schemes = getSavedSchemes();
            const schemeNames = Object.keys(schemes);

            while (loadSchemeSelect.options.length > 1) {
                loadSchemeSelect.remove(1);
            }

            schemeNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                loadSchemeSelect.appendChild(option);
            });
        }

        function saveCurrentScheme() {
            const schemeName = schemeNameInput.value.trim();

            if (!schemeName) {
                showToast('è¯·è¾“å…¥æ–¹æ¡ˆåç§°');
                return;
            }

            const optionItems = document.querySelectorAll('.option-item');

            if (optionItems.length < 2) {
                showToast('è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹æ‰èƒ½ä¿å­˜æ–¹æ¡ˆ');
                return;
            }

            const optionsData = Array.from(optionItems).map(item => {
                const nameInput = item.querySelector('input[type="text"]');
                const ratioInput = item.querySelector('input[type="number"]');

                return {
                    name: nameInput.value.trim() || `é€‰é¡¹`,
                    ratio: parseInt(ratioInput.value) || 1
                };
            });

            const currentSettings = {
                options: optionsData,
                preventDuplicates: preventDuplicatesCheckbox.checked,
                spinIntensity: parseInt(spinIntensitySlider.value)
            };

            const schemes = getSavedSchemes();
            schemes[schemeName] = currentSettings;
            saveSchemes(schemes);

            loadSavedSchemes();
            schemeNameInput.value = '';

            showToast(`æ–¹æ¡ˆ"${schemeName}"å·²ä¿å­˜`);
        }

        function loadSelectedScheme() {
            const selectedSchemeName = loadSchemeSelect.value;

            if (!selectedSchemeName) {
                return;
            }

            const schemes = getSavedSchemes();
            const schemeData = schemes[selectedSchemeName];

            if (!schemeData) {
                showToast('æ–¹æ¡ˆä¸å­˜åœ¨');
                return;
            }

            const optionItems = document.querySelectorAll('.option-item');
            optionItems.forEach((item, index) => {
                if (index > 0) {
                    item.remove();
                }
            });

            const firstOptionItem = document.querySelector('.option-item');

            schemeData.options.forEach((option, index) => {
                let optionItem;

                if (index === 0 && firstOptionItem) {
                    optionItem = firstOptionItem;
                } else {
                    addOptionField();
                    optionItem = document.querySelectorAll('.option-item')[index];
                }

                const nameInput = optionItem.querySelector('input[type="text"]');
                const ratioInput = optionItem.querySelector('input[type="number"]');

                nameInput.value = option.name;
                ratioInput.value = option.ratio;
            });

            preventDuplicatesCheckbox.checked = schemeData.preventDuplicates || false;
            spinIntensitySlider.value = schemeData.spinIntensity || 7;

            updateIntensityDisplay();
            applySettings();

            showToast(`å·²åŠ è½½æ–¹æ¡ˆ"${selectedSchemeName}"`);
        }

        function deleteSelectedScheme() {
            const selectedSchemeName = loadSchemeSelect.value;

            if (!selectedSchemeName) {
                showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–¹æ¡ˆ');
                return;
            }

            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–¹æ¡ˆ"${selectedSchemeName}"å—ï¼Ÿ`)) {
                const schemes = getSavedSchemes();
                delete schemes[selectedSchemeName];
                saveSchemes(schemes);

                loadSavedSchemes();
                showToast(`æ–¹æ¡ˆ"${selectedSchemeName}"å·²åˆ é™¤`);
            }
        }

        function clearAllSchemes() {
            const schemes = getSavedSchemes();

            if (Object.keys(schemes).length === 0) {
                showToast('æ²¡æœ‰ä¿å­˜çš„æ–¹æ¡ˆ');
                return;
            }

            if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ä¿å­˜çš„æ–¹æ¡ˆå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(SCHEME_STORAGE_KEY);
                loadSavedSchemes();
                showToast('æ‰€æœ‰æ–¹æ¡ˆå·²æ¸…ç©º');
            }
        }
    </script>
</body>

</html>
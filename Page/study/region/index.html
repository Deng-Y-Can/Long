<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地区信息展示平台</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <style type="text/tailwindcss">
        @theme {
            --color-primary: #3b82f6;
            --color-secondary: #10b981;
            --color-accent: #f59e0b;
            --color-highlight: #fef3c7;
            --font-inter: 'Inter', sans-serif;
        }

        @utility smooth-transition {
            transition: all 0.3s ease-in-out;
        }

        @utility card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .highlight {
            background-color: var(--color-highlight);
            font-weight: 500;
        }

        body {
            font-family: var(--font-inter);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- 头部区域 -->
        <header class="mb-6 flex justify-between items-center flex-wrap gap-4">
            <h1 class="text-3xl font-bold text-gray-800">地区信息展示平台</h1>
            <!-- 随机数据展示区域（右上角） -->
            <div id="randomCard" class="bg-white rounded-lg p-4 card-shadow smooth-transition w-full md:w-64">
                <h2 class="text-sm font-semibold text-gray-700 mb-2">随机地区</h2>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-2">
                        <i class="fas fa-map-marked-alt text-primary text-xl"></i>
                    </div>
                    <p class="text-gray-500 text-sm" id="randomInfo">加载中...</p>
                </div>
            </div>
        </header>

        <!-- 主内容区域 -->
        <div class="flex flex-col md:flex-row gap-6">
            <!-- 左侧省份菜单栏 -->
            <div class="md:w-1/5 bg-white rounded-lg p-4 card-shadow">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">省份筛选</h2>
                <div class="space-y-2 max-h-96 overflow-y-auto pr-2" id="provinceMenu">
                    <button class="province-btn w-full text-left px-3 py-2 rounded hover:bg-primary/10 smooth-transition bg-primary/10 text-primary font-medium" data-province="all">
                        <i class="fas fa-globe-americas mr-2"></i>全部省份
                    </button>
                    <!-- 省份按钮将通过JS动态生成 -->
                </div>
            </div>

            <!-- 右侧内容区域 -->
            <div class="md:w-4/5 flex flex-col">
                <!-- 筛选和查询区域 -->
                <div class="bg-white rounded-lg p-4 card-shadow mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="search" class="block text-sm font-medium text-gray-700 mb-1">搜索地区</label>
                            <div class="relative">
                                <input type="text" id="search" placeholder="输入城市/区县/景点..."
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                                <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-primary">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="sort" class="block text-sm font-medium text-gray-700 mb-1">排序方式</label>
                            <select id="sort" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                                <option value="default">默认排序</option>
                                <option value="province">按省份</option>
                                <option value="city">按城市</option>
                                <option value="county">按区县</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">按距离筛选</label>
                            <div class="flex flex-col">
                                <div class="flex items-center mb-2">
                                    <label for="targetLng" class="w-24 text-sm text-gray-700">目标经度：</label>
                                    <input type="number" id="targetLng" step="0.000001" placeholder="输入经度"
                                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                                </div>
                                <div class="flex items-center">
                                    <label for="targetLat" class="w-24 text-sm text-gray-700">目标纬度：</label>
                                    <input type="number" id="targetLat" step="0.000001" placeholder="输入纬度"
                                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                                </div>
                                <button id="distanceFilter" class="mt-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 smooth-transition">
                                    按距离筛选
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据展示区域 -->
                <div class="bg-white rounded-lg p-4 card-shadow flex-grow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-700">地区信息列表</h2>
                        <div class="text-sm text-gray-500" id="dataCount">共 0 条数据</div>
                    </div>
                    <div id="dataContainer" class="space-y-3">
                        <!-- 数据将通过JS动态插入 -->
                        <div class="text-center text-gray-500 py-8">数据加载中...</div>
                    </div>
                    <!-- 分页区域 -->
                    <div class="flex justify-center mt-6" id="pagination">
                        <!-- 分页按钮将通过JS动态插入 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allAreas = [];
        const provinces = new Set();
        let currentPage = 1;
        const pageSize = 20;
        let filteredData = [];
        let currentSearch = '';

        // 从JSON文件读取数据
        fetch('areas.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应不正常');
                }
                return response.json();
            })
            .then(data => {
                // 扁平化JSON数据，将所有地区信息放入一个数组，并提取所有省份
                for (const region in data) {
                    if (data.hasOwnProperty(region)) {
                        const areaList = data[region];
                        allAreas = allAreas.concat(areaList);
                        areaList.forEach(area => {
                            provinces.add(area.province);
                        });
                    }
                }

                // 渲染省份筛选按钮
                renderProvinceButtons();
                // 初始化数据
                filteredData = allAreas;
                updateDataDisplay();
                // 初始展示一个随机地区
                showRandomArea();
                // 定时切换随机地区，每5秒一次
                setInterval(showRandomArea, 5000);
            })
            .catch(error => {
                console.error('读取JSON数据失败：', error);
                const container = document.getElementById('dataContainer');
                container.innerHTML = '<div class="text-center text-red-500 py-8">数据加载失败，请检查JSON文件是否存在或格式是否正确</div>';
            });

        // 当前筛选的省份
        let currentProvince = 'all';
        // 当前排序方式
        let currentSort = 'default';
        // 当前目标经纬度
        let currentTargetLng = null;
        let currentTargetLat = null;

        // 渲染省份筛选按钮
        function renderProvinceButtons() {
            const provinceContainer = document.getElementById('provinceMenu');
            const provincesArray = Array.from(provinces).sort();

            provincesArray.forEach(province => {
                const btn = document.createElement('button');
                btn.className = 'province-btn w-full text-left px-3 py-2 rounded hover:bg-primary/10 smooth-transition';
                btn.dataset.province = province;
                btn.innerHTML = `<i class="fas fa-map-marker-alt mr-2"></i>${province}`;
                provinceContainer.appendChild(btn);
            });

            // 为省份按钮添加点击事件
            document.querySelectorAll('.province-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    // 重置其他按钮样式
                    document.querySelectorAll('.province-btn').forEach(b => {
                        b.classList.remove('bg-primary/10', 'text-primary', 'font-medium');
                    });
                    // 设置当前按钮样式
                    this.classList.add('bg-primary/10', 'text-primary', 'font-medium');

                    currentProvince = this.dataset.province;
                    currentPage = 1; // 重置到第一页
                    updateDataDisplay();
                });
            });
        }

        // 渲染数据到页面（带分页和关键字高亮）
        function renderData(data, page) {
            const container = document.getElementById('dataContainer');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">未找到匹配数据</div>';
                document.getElementById('pagination').innerHTML = '';
                document.getElementById('dataCount').textContent = `共 0 条数据`;
                return;
            }

            const startIndex = (page - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, data.length);
            const pageData = data.slice(startIndex, endIndex);

            pageData.forEach(area => {
                const card = document.createElement('div');
                card.className = 'border border-gray-200 rounded-lg p-3 smooth-transition hover:card-shadow';

                // 关键字高亮处理
                let provinceText = area.province;
                let cityText = area.city;
                let countyText = area.county;
                let sceneryText = area.feature_scenery;
                let foodText = area.feature_food;

                if (currentSearch) {
                    const regex = new RegExp(currentSearch, 'gi');
                    provinceText = provinceText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    cityText = cityText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    countyText = countyText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    sceneryText = sceneryText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    foodText = foodText.replace(regex, match => `<span class="highlight">${match}</span>`);
                }

                // 如果有距离信息，则显示
                const distanceHtml = area.distance ?
                    `<span class="text-xs bg-accent/10 text-accent px-2 py-1 rounded">距离：${area.distance.toFixed(2)}公里</span>` : '';

                card.innerHTML = `
                  <div class="flex flex-col md:flex-row">
                    <div class="md:w-1/5 mb-3 md:mb-0">
                      <h3 class="text-lg font-semibold text-gray-800">${countyText}</h3>
                      <p class="text-gray-600 text-sm">${provinceText} ${cityText}</p>
                      <p class="text-gray-500 text-sm mt-1">经度：${area.longitude.toFixed(6)}</p>
                      <p class="text-gray-500 text-sm">纬度：${area.latitude.toFixed(6)}</p>
                    </div>
                    <div class="md:w-4/5 md:pl-3">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                          <h4 class="text-sm font-medium text-gray-700 mb-1">特色景点</h4>
                          <p class="text-gray-600 text-sm line-clamp-2">${sceneryText}</p>
                        </div>
                        <div>
                          <h4 class="text-sm font-medium text-gray-700 mb-1">特色美食</h4>
                          <p class="text-gray-600 text-sm line-clamp-2">${foodText}</p>
                        </div>
                      </div>
                      <div class="mt-2 flex flex-wrap gap-2">
                        <span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">邮编：${area.zip_code}</span>
                        <span class="text-xs bg-secondary/10 text-secondary px-2 py-1 rounded">车牌前缀：${area.license_plate_prefix}</span>
                        ${distanceHtml}
                      </div>
                    </div>
                  </div>
                `;
                container.appendChild(card);
            });

            // 渲染分页
            renderPagination(data.length, page);
            document.getElementById('dataCount').textContent = `共 ${data.length} 条数据`;
        }

        // 渲染分页
        function renderPagination(total, currentPage) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(total / pageSize);
            if (totalPages <= 1) return;

            // 上一页
            const prevBtn = document.createElement('button');
            prevBtn.className = `px-3 py-1 rounded ${currentPage === 1 ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-white hover:bg-gray-100 smooth-transition'}`;
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage = currentPage - 1;
                    renderData(filteredData, currentPage);
                }
            });
            pagination.appendChild(prevBtn);

            // 页码（仅显示当前页附近的页码，避免过多页码）
            const showPageNumbers = 5; // 最多显示的页码数量
            let startPage = Math.max(1, currentPage - Math.floor(showPageNumbers / 2));
            let endPage = startPage + showPageNumbers - 1;

            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(1, endPage - showPageNumbers + 1);
            }

            // 显示第一页
            if (startPage > 1) {
                const firstBtn = createPageButton(1);
                pagination.appendChild(firstBtn);

                // 如果有间隔，显示省略号
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'px-2 py-1 text-gray-500';
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
            }

            // 显示中间页码
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPageButton(i);
                pagination.appendChild(pageBtn);
            }

            // 显示最后一页
            if (endPage < totalPages) {
                // 如果有间隔，显示省略号
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'px-2 py-1 text-gray-500';
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }

                const lastBtn = createPageButton(totalPages);
                pagination.appendChild(lastBtn);
            }

            // 下一页
            const nextBtn = document.createElement('button');
            nextBtn.className = `px-3 py-1 rounded ${currentPage === totalPages ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-white hover:bg-gray-100 smooth-transition'}`;
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage = currentPage + 1;
                    renderData(filteredData, currentPage);
                }
            });
            pagination.appendChild(nextBtn);
        }

        // 创建页码按钮
        function createPageButton(pageNum) {
            const pageBtn = document.createElement('button');
            pageBtn.className = `px-3 py-1 rounded ${pageNum === currentPage ? 'bg-primary text-white' : 'bg-white hover:bg-gray-100 smooth-transition'}`;
            pageBtn.textContent = pageNum;
            pageBtn.addEventListener('click', () => {
                currentPage = pageNum;
                renderData(filteredData, currentPage);
            });
            return pageBtn;
        }

        // 更新数据展示（结合筛选、搜索、排序等条件）
        function updateDataDisplay() {
            let data = [...allAreas]; // 复制数组，避免修改原数据

            // 按省份筛选
            if (currentProvince !== 'all') {
                data = data.filter(area => area.province === currentProvince);
            }

            // 按搜索关键词筛选
            currentSearch = document.getElementById('search').value.toLowerCase().trim();
            if (currentSearch) {
                data = data.filter(area => {
                    return area.province.toLowerCase().includes(currentSearch) ||
                        area.city.toLowerCase().includes(currentSearch) ||
                        area.county.toLowerCase().includes(currentSearch) ||
                        area.feature_scenery.toLowerCase().includes(currentSearch) ||
                        area.feature_food.toLowerCase().includes(currentSearch);
                });
            }

            // 按距离筛选
            if (currentTargetLng !== null && currentTargetLat !== null) {
                // Haversine公式计算两点间距离（单位：公里）
                const calculateDistance = (lat1, lon1, lat2, lon2) => {
                    const R = 6371; // 地球半径（公里）
                    const dLat = (lat2 - lat1) * Math.PI / 180;
                    const dLon = (lon2 - lon1) * Math.PI / 180;
                    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
                    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                    return R * c;
                };

                // 计算每个地区到目标点的距离，并排序
                const dataWithDistance = data.map(area => {
                    const distance = calculateDistance(currentTargetLat, currentTargetLng, area.latitude, area.longitude);
                    return { ...area, distance };
                });

                data = dataWithDistance.sort((a, b) => a.distance - b.distance);
            } else {
                // 移除可能存在的距离属性
                data = data.map(area => {
                    const { distance, ...rest } = area;
                    return rest;
                });
            }

            // 排序
            if (currentSort === 'province') {
                data.sort((a, b) => a.province.localeCompare(b.province));
            } else if (currentSort === 'city') {
                data.sort((a, b) => a.city.localeCompare(b.city));
            } else if (currentSort === 'county') {
                data.sort((a, b) => a.county.localeCompare(b.county));
            }

            filteredData = data;
            renderData(filteredData, currentPage);
        }

        // 搜索功能
        const searchInput = document.getElementById('search');
        searchInput.addEventListener('input', function () {
            currentPage = 1; // 重置到第一页
            updateDataDisplay();
        });

        // 排序功能
        const sortSelect = document.getElementById('sort');
        sortSelect.addEventListener('change', function () {
            currentSort = this.value;
            currentPage = 1; // 重置到第一页
            updateDataDisplay();
        });

        // 按距离筛选功能
        const distanceFilterBtn = document.getElementById('distanceFilter');
        distanceFilterBtn.addEventListener('click', function () {
            const targetLng = parseFloat(document.getElementById('targetLng').value);
            const targetLat = parseFloat(document.getElementById('targetLat').value);

            if (isNaN(targetLng) || isNaN(targetLat)) {
                alert('请输入有效的经纬度');
                return;
            }

            currentTargetLng = targetLng;
            currentTargetLat = targetLat;
            currentPage = 1; // 重置到第一页
            updateDataDisplay();
        });

        // 随机展示功能
        function showRandomArea() {
            if (allAreas.length === 0) return;
            const randomIndex = Math.floor(Math.random() * allAreas.length);
            const randomArea = allAreas[randomIndex];
            const randomInfoEl = document.getElementById('randomInfo');
            randomInfoEl.innerHTML = `
                <div class="text-lg font-semibold text-gray-800 mb-2">${randomArea.county}（${randomArea.province} ${randomArea.city}）</div>
                <p class="text-gray-600 text-sm mb-1"><i class="fas fa-map-marker-alt mr-1"></i> 经纬度：${randomArea.longitude.toFixed(6)}, ${randomArea.latitude.toFixed(6)}</p>
                <p class="text-gray-600 text-sm"><i class="fas fa-utensils mr-1"></i> 特色美食：${randomArea.feature_food.substring(0, 50)}${randomArea.feature_food.length > 50 ? '...' : ''}</p>
              `;
        }
    </script>
</body>

</html>